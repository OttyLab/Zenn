---
title: "Mapbox Search JS ã‚’è§¦ã£ã¦ã¿ã‚‹ (SearchBox/Reactç·¨)"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript", "react"]
published: true
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯[Mapbox Search JS ã‚’è§¦ã£ã¦ã¿ã‚‹ (SearchBox/Webç·¨)](https://zenn.dev/ottylab/articles/4b4e3ff049d8cb/)ã®ç¶šãã§ã€Search JSã®SearchBox/Reactã®ä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚Search Box - React Quickstartã®[Integration with a Mapbox GL JS Map](https://docs.mapbox.com/mapbox-search-js/guides/search/react/#integration-with-a-mapbox-gl-js-map)ã‚’å‚è€ƒã«ã—ã¤ã¤ã€[Add Search Box for Japan](https://docs.mapbox.com/mapbox-search-js/example/japan-search-box/)ã¨åŒã˜ã‚‚ã®ã‚’ä½œæˆã—ã¾ã™ã€‚

ä»¥ä¸‹ãŒæœ¬ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¢ã§ã™ã€‚[Safari](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚„[Firefox](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚’ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ã¯ãƒ‡ãƒ¢ãŒå®Ÿè¡Œã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚Chromeã§è¡¨ç¤ºã™ã‚‹ã‹ã€ https://stackblitz.com/edit/vitejs-vite-xlu7yg ã‚’ç›´æ¥ã”å‚ç…§ãã ã•ã„ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-xlu7yg?embed=1&view=preview)


# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã“ã®è¨˜äº‹ã§ã¯vite + Reactã‚’ä½¿ç”¨ã—ã¾ã™ã€‚[å…¬å¼ã‚¬ã‚¤ãƒ‰](https://ja.vitejs.dev/guide/#%E6%9C%80%E5%88%9D%E3%81%AE-vite-%E3%83%95%E3%82%9A%E3%83%AD%E3%82%B7%E3%82%99%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B)ã«ã—ãŸãŒã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```zsh
% npm create vite@latest
Need to install the following packages:
create-vite@5.2.3
Ok to proceed? (y) y
âœ” Project name: â€¦ searchjs-searchbox-react
âœ” Select a framework: â€º React
âœ” Select a variant: â€º JavaScript

Scaffolding project in /Users/yochi/Downloads/20240608/searchjs-searchbox-react...

Done. Now run:

  cd searchjs-searchbox-react
  npm install
  npm run dev
```

æ¬¡ã«[Search Box - React Quickstart](https://docs.mapbox.com/mapbox-search-js/guides/search/react/)ã«ã—ãŸãŒã„ã€`serch-js-react`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```zsh
% npm install @mapbox/search-js-react
```

æœ€å¾Œã«Mapbox GL JSã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```zsh
% npm install mapbox-gl 
```


# ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°

ãã‚Œã§ã¯å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã®ä¸­èº«ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

## App.js

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½œæˆã•ã‚Œã¦ã„ãŸé››å½¢ã‚’å‰Šé™¤ã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```JavaScript
import { useRef, useEffect, useState } from 'react';
import { SearchBox } from '@mapbox/search-js-react';
import mapboxgl from 'mapbox-gl';
import 'mapbox-gl/dist/mapbox-gl.css';
import './App.css'

const accessToken = 'YOUR_MAPBOX_ACCESS_TOKEN';

export default function App() {
  const mapContainerRef = useRef();
  const searchBoxRef = useRef();
  const mapInstanceRef = useRef();
  const [mapLoaded, setMapLoaded] = useState(false);
  const [inputValue, setInputValue] = useState('');
  useEffect(() => {
    mapboxgl.accessToken = accessToken;

    mapInstanceRef.current = new mapboxgl.Map({
      container: mapContainerRef.current,
      style: 'mapbox://styles/mapbox-search-web/cl5l944i6000k14o4ing22srv',
      center: [139.77, 35.68],
      zoom: 6,
    });

    mapInstanceRef.current.on('load', () => {
      setMapLoaded(true);
    });
  }, []);

  return (
    <>
      <div
        id="map-container"
        ref={mapContainerRef}
      ></div>
      <div
        id="control"
      >
        <SearchBox
          accessToken={accessToken}
          map={mapInstanceRef.current}
          mapboxgl={mapboxgl}
          value={inputValue}
          options={{ country: 'jp', language: 'ja' }}
          onChange={(d) => {
            setInputValue(d);
          }}
          marker
        />
      </div>
    </>
  );
}
```

å†…å®¹ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

### Mapã®ä½œæˆ

Mapbox GL JSã¯Reactã«å¯¾å¿œã—ã¦ã„ãªã„ãŸã‚ã€`userEffect`ã®ä¸­ã§ä½œæˆã—ã¾ã™ã€‚
```JavaScript
useEffect(() => {
  // ä¸­èº«
}, []);
```

ä¸­èº«ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã‚ˆãè¦‹ã‚‹ã¨ã„ã¤ã‚‚é€šã‚Šã§ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯`container`ã¨ã—ã¦`ref`(DOMã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ãŒã€ã„ã¤ã‚‚é€šã‚Š`id`å (ã“ã“ã§ã¯`map-container`)ã§ã‚‚OKã§ã™ã€‚ã“ã‚Œã¯ã€Mapã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãŒ[ã©ã¡ã‚‰ã®ã‚±ãƒ¼ã‚¹ã§ã‚‚å‡¦ç†ã™ã‚‹](https://github.com/mapbox/mapbox-gl-js/blob/v3.4.0/src/ui/map.js#L605-L617)ã‚ˆã†ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

```JavaScript
  mapInstanceRef.current = new mapboxgl.Map({
    container: mapContainerRef.current,
    style: 'mapbox://styles/mapbox-search-web/cl5l944i6000k14o4ing22srv',
    center: [139.77, 35.68],
    zoom: 6,
  });
```

### ãƒ­ãƒ¼ãƒ‰å¾Œã®å‡¦ç†

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ä½¿ç”¨ã—ã¾ã›ã‚“ãŒã€`load`æ™‚ã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚`mapLoaded`ã‚¹ãƒ†ãƒ¼ãƒˆã‚’`true`ã«å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ç›£è¦–ã—ã¦ã€å„ç¨®UIã®å¤‰æ›´å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```JavaScript
mapInstanceRef.current.on('load', () => {
  setMapLoaded(true);
});
```

### JSX
æ¬¡ã«JSXã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

```JSX
return (
  <>
    // ä¸­èº«
  </>
);
```

#### Mapã‚³ãƒ³ãƒ†ãƒŠ

Mapã®ä½œæˆã§å‡ºã¦ããŸMapã®ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚

```JSX
<div
  id="map-container"
  ref={mapContainerRef}
></div>
```

#### Controlã‚³ãƒ³ãƒ†ãƒŠ

`SearchBox`ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚Webã§ã¯[`Map#addControl`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addcontrol)ã§`MapboxSearchBox`ã‚’è¿½åŠ ã—ã¾ã™ãŒã€Reactã§ã¯ãã®æ‰‹æ³•ãŒä½¿ãˆã¾ã›ã‚“ã€‚ãã“ã§ã€è‡ªåˆ†ã§è¡¨ç¤ºã™ã‚‹å ´æ‰€ã‚’æº–å‚™ã—ã¾ã™ã€‚

```JSX
<div
  id="control"
>
  // SearchBox
</div>
```

#### SearchBox

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.mapbox.com/mapbox-search-js/api/react/search/#searchbox)ã®é€šã‚Šã€SearchBoxã‚’ä½œæˆã—ã¾ã™ã€‚æŒ‡å®šå¯èƒ½ãªPropsã¯[ã“ã“](https://docs.mapbox.com/mapbox-search-js/api/react/search/#searchboxprops)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

```JSX
<SearchBox
  accessToken={accessToken}
  map={mapInstanceRef.current}
  mapboxgl={mapboxgl}
  value={inputValue}
  options={{ country: 'jp', language: 'ja' }}
  onChange={(d) => {
    setInputValue(d);
  }}
  marker
/>
```

## App.css

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½œæˆã•ã‚Œã¦ã„ãŸé››å½¢ã‚’å‰Šé™¤ã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚`#map-container`ã¯Mapã®ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚ã“ã‚Œã¯Webã®ã¨ãã¨åŒã˜ã§ã™ã€‚`#control`ã¯`SearchBox`ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚`addControl`ã‚’ä½¿ã£ãŸã¨ãã¨åŒã˜è¦‹ãŸç›®ã«å¯„ã›ã¦ã„ã¾ã™ã€‚

```css
#map-container {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
}

#control {
    margin: 10px 10px 0px 0px;
    position: absolute;
    top: 0;
    right: 0;
    display: block;
    width: 300px;
}
```

## index.css

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½œæˆã•ã‚Œã¦ã„ãŸé››å½¢ã‚’å‰Šé™¤ã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚ Webã®ã¨ãã¨åŒã˜è¨­å®šã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

```css
body {
    margin: 0;
    padding: 0;
}
```


# Search Box/Web ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

## ãƒ†ãƒ¼ãƒã®å¤‰æ›´
ä»¥ä¸‹ã®ã‚ˆã†ã«`SearchBox`ã®`theme`propã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹éƒ¨åˆ†ã®ãƒ†ãƒ¼ãƒã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚è¨˜è¿°å†…å®¹ã¯Webã¨åŒã˜ã§ã™ã€‚`variables`ã¯[å®šç¾©æ¸ˆã¿ã®ãƒ†ãƒ¼ãƒ](https://docs.mapbox.com/mapbox-search-js/api/web/theming/#themevariables)ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚ã“ã“ã§ã¯ãƒ†ã‚­ã‚¹ãƒˆã®æ–‡å­—è‰²ã¨èƒŒæ™¯è‰²ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚`cssText`ã¯å®šç¾©æ¸ˆã¿ä»¥å¤–ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ã—ãŸã„å ´åˆã«ç›´æ¥CSSã¨ã—ã¦è¨˜è¿°ã™ã‚‹æ–‡å­—åˆ—ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã“ã§ã¯ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒé‡ãªã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§èƒŒæ™¯è‰²ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚

```JSX
theme={{
  variables: {
    colorText: "red",
    colorBackground: "gold"
  },
  cssText: "input:hover { background: lightyellow; }"
}}
```

## ãƒãƒ¼ã‚«ãƒ¼ã®å¤‰æ›´
`SearchBox`ã®`marker`propã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚Mapbox GL JSã®`Marker`ã®[ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³](https://docs.mapbox.com/mapbox-gl-js/api/markers/#marker)ãŒæŒ‡å®šã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®Mapbox GL JSã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ä½œæˆã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
https://docs.mapbox.com/mapbox-gl-js/example/marker-horizon-aligned/

ã¾ãšã€App.cssã«ä»¥ä¸‹ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã¾ãŸã€ãƒ”ãƒ³ã®ç”»åƒã¯ https://docs.mapbox.com/mapbox-gl-js/assets/pin.svg ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦`public`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚Œã¦ãŠãã¾ã™ã€‚

```css
.marker {
  background-image: url('/pin.svg');
  background-size: cover;
  cursor: pointer;
}
```

æ¬¡ã«ã€App.jsxã®App()ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ä»¥ä¸‹ã®å®šæ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```JavaScript
const size = 100;
```

æœ€å¾Œã«ã€SearchBoxã®propsã®`marker`ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```JSX
marker={{
    element: (() => {
        const el = document.createElement('div');
        el.className = 'marker';
        el.style.width = `${size}px`;
        el.style.height = `${size}px`;
        return el;
    })(),
    rotationAlignment: "horizon",
    offset: [0, -size / 2],
}}
```

## çµæœ
çµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚[Safari](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚„[Firefox](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚’ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ã¯ãƒ‡ãƒ¢ãŒå®Ÿè¡Œã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚Chromeã§è¡¨ç¤ºã™ã‚‹ã‹ã€ https://stackblitz.com/edit/vitejs-vite-bcbhaq ã‚’ç›´æ¥ã”å‚ç…§ãã ã•ã„ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-bcbhaq?embed=1&file=src%2FApp.jsx&view=preview)


# ã¾ã¨ã‚
å°‘ã—ã‚¯ã‚»ãŒã‚ã‚Šã¾ã™ãŒã€Reactç‰ˆã§ã‚‚ç°¡å˜ã«Search Boxã®æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
