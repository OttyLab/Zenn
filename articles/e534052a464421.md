---
title: "Mapbox Newsletter WEEKLY TIPSã®è§£èª¬ -ã€Œãƒ•ã‚£ãƒ¼ãƒãƒ£ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã€"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥é…ä¿¡ã•ã‚ŒãŸMapbox Newsletterã®WEEKLY TIPSã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€Œãƒ•ã‚£ãƒ¼ãƒãƒ£ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã€ã«ã¤ã„ã¦ã®è§£èª¬ã§ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯GeoJSONã®ãƒ‡ãƒ¼ã‚¿ã‚’å‹•çš„ã«å¤‰æ›´ã—è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’ä¾‹ç¤ºã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€Newsletterã®è³¼èª­ã¯[ã“ã¡ã‚‰](https://www.mapbox.jp/blog?#:~:text=%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%AC%E3%82%BF%E3%83%BC%E3%82%92%E8%B3%BC%E8%AA%AD)ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã€‚


# ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

ã¾ãšExamplesã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã«è¡Œãã¾ã—ã‚‡ã†ã€‚

æ—¥æœ¬èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/jp/mapbox-gl-js/example/live-update-feature/)

è‹±èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/mapbox-gl-js/example/live-update-feature/)

ã‚¿ã‚¤ãƒˆãƒ«ãŒæ—¥æœ¬èªè¨³ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€Mapbox GL JSã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒç•°ãªã‚‹ã“ã¨ä»¥å¤–ã¯åŒã˜ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

## HTML/CSS

ã¾ãšHTMLã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã¯åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

```HTML
<div id="map"></div>
```

## Mapã®ä½œæˆ

æ¬¡ã«JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã„ã¤ã‚‚é€šã‚Šã€Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚`container`ã§åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®idã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
const map = new mapboxgl.Map({
  container: 'map',
  // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
  style: 'mapbox://styles/mapbox/satellite-v9',
  zoom: 0
});
```

æ®‹ã‚Šã®ã‚³ãƒ¼ãƒ‰ã¯`load`ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆ`map.on('load', async ()=>{})`ï¼‰ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚é€”ä¸­ã§GeoJSONã®ãƒ‡ãƒ¼ã‚¿ã‚’`fetch`ã§å–å¾—ã™ã‚‹ãŸã‚ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯`async`ã¨ã—ã¦å®£è¨€ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã•ã¦ã€é€šå¸¸GeoJSONã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹å ´åˆã¯[`Map#addSource`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addsource)ã®å¼•æ•°ã«URLã¨ã—ã¦ç›´æ¥æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚ãã‚Œã«å¯¾ã—ã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯GeoJSONã‚’ä¸€åº¦`fetch`ã§å–å¾—ã—ã¾ã™ã€‚ã“ã‚Œã¯å‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹ã¨ã„ã†ãƒ‡ãƒ¢ã‚’ã™ã‚‹é–¢ä¿‚ä¸Šã€ã¾ãšå…¨ãƒ‡ãƒ¼ã‚¿ã®GeoJSONã‚’å–å¾—ã—ã€ãã®ã‚ã¨å°‘ã—ãšã¤ã‚½ãƒ¼ã‚¹ã«è¿½åŠ ã—ã¦ã„ããŸã‚ã§ã™ã€‚

```JavaScript
const response = await fetch(
  'https://docs.mapbox.com/mapbox-gl-js/assets/hike.geojson'
);
const data = await response.json();
```

GeoJSONã®ä¸­èº«ã‚’ç¢ºèªã—ã¾ã™ã€‚LineStringãŒä¸€ã¤ã ã‘å…¥ã£ã¦ã„ã¾ã™ã€‚
![GeoJSON](/images/articles/e534052a464421/geojson.png)

ãã—ã¦`coordinates`ã«LineStringã®åº§æ¨™ã‚’ä»£å…¥ã—ã¦ã„ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã¯`[çµŒåº¦,ç·¯åº¦]`ãŒé…åˆ—ã«å…¥ã£ãŸã‚‚ã®ã§ã™ã€‚æ­£ç¢ºã«ã¯å‚ç…§ãŒä»£å…¥ã•ã‚Œã¾ã™ã€‚

```JavaScript
// save full coordinate list for later
const coordinates = data.features[0].geometry.coordinates;
```

`data`ã‚’ã‚½ãƒ¼ã‚¹ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä»£ç”¨ã™ã¹ãã€1ã¤ç›®ã®åº§æ¨™ã ã‘ã‚’å«ã‚€æ–°ã—ã„é…åˆ—ã‚’ä½œæˆã—ã¦ãã®å‚ç…§ãŒ`coordinates`ã«ä»£å…¥ã•ã‚Œã¾ã™ã€‚

```JavaScript
// start by showing just the first coordinate
data.features[0].geometry.coordinates = [coordinates[0]];
```

ãã—ã¦ã€ãã®1ã¤ç›®ã®åº§æ¨™ã ã‘ã‚’å«ã‚€GeoJSONï¼ˆ`data`ï¼‰ã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ç™»éŒ²ï¼ˆ`addSource`ï¼‰ã—ã€Lineãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```JavaScript
// add it to the map
map.addSource('trace', { type: 'geojson', data: data });
map.addLayer({
  'id': 'trace',
  'type': 'line',
  'source': 'trace',
  'paint': {
    'line-color': 'yellow',
    'line-opacity': 0.75,
    'line-width': 5
  }
});
```

ã‚«ãƒ¡ãƒ©ã®ä¸­å¿ƒã‚’1ã¤ç›®ã®åº§æ¨™ã«ç§»å‹•ã•ã›ã€ã‚ºãƒ¼ãƒ ã‚’14ã€ãƒ”ãƒƒãƒã‚’30ã«è¨­å®šã—ã¾ã™ã€‚

```JavaScript
// setup the viewport
map.jumpTo({ 'center': coordinates[0], 'zoom': 14 });
map.setPitch(30);
```

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ãŸã‚ã«`setInterval`ã§å®šæœŸçš„ã«æ›´æ–°å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚`if (i < coordinates.length)`ã«ã‚ˆã‚Šã€å…ƒã®åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã™ã¹ã¦ã®ç‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å‡¦ç†ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

`data.features[0].geometry.coordinates.push(coordinates[i])`ã¯`i`ç•ªç›®ã®åº§æ¨™ã‚’ãƒ‡ãƒ¼ã‚¿ã®æœ«å°¾ã«è¿½åŠ ã—ã¾ã™ã€‚`map.getSource('trace').setData(data)`ã§ã‚½ãƒ¼ã‚¹ã‚’æ›´æ–°ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ã‚‚`setData`ã‚’å‘¼ã°ãªã„ã¨ã‚½ãƒ¼ã‚¹ã¯æ›´æ–°ã•ã‚Œãªã„ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ãã—ã¦ã€`map.panTo(coordinates[i])`ã§ã‚«ãƒ¡ãƒ©ã‚’`i`ç•ªç›®ã®åº§æ¨™ã«ç§»å‹•ã•ã›ã¾ã™ã€‚

```JavaScript
// on a regular basis, add more coordinates from the saved list and update the map
let i = 0;
const timer = setInterval(() => {
  if (i < coordinates.length) {
    data.features[0].geometry.coordinates.push(coordinates[i]);
    map.getSource('trace').setData(data);
    map.panTo(coordinates[i]);
    i++;
  } else {
    window.clearInterval(timer);
  }
}, 10);
```

# ã¾ã¨ã‚

ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã‚‹ãŸã³ã«`setData`ã§æ›´æ–°ã™ã‚‹ã¨ã“ã‚ãŒãƒã‚¤ãƒ³ãƒˆã§ã—ãŸã€‚ç§»å‹•ä½“ã®åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’å®šæœŸçš„ã«å–å¾—ã—ã€ãã®è»Œè·¡ã‚’æãã¨ã„ã£ãŸå¿œç”¨ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã­ã€‚
