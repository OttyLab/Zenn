---
title: "Mapbox Maps SDK Flutter Plugin"
emoji: "ğŸ“˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "Flutter", "GIS"]
published: true
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯[Mapbox Maps SDK Flutter Pluginã§ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ“ä½œã™ã‚‹](https://zenn.dev/ottylab/articles/48bc1a0b1acde2)ã®ç¶šãã§ã™ã€‚SDKã«åŒæ¢±ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚’å‹•ã‹ã—ã€æ›´ã«ä½¿ã„æ–¹ã‚’è©³ã—ãè¦‹ã¦ã„ãã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ã‚’æ‰‹å…ƒã§å‹•ã‹ã™

Mapbox Maps SDK for Android/iOSã¨åŒæ§˜ã«Mapbox Maps SDK Flutter Pluginã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã«ã¯å¤šæ•°ã®ã‚µãƒ³ãƒ—ãƒ«ãŒåŒæ¢±ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ãˆã‚‹çŠ¶æ…‹ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

0. Mapbox Maps SDK for Android/iOSãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ãŸã‚ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šï¼ˆè©³ã—ã„è¨­å®šæ–¹æ³•ã¯[Mapbox Maps SDK Flutter Pluginã‚’ä½¿ã£ã¦ã¿ã‚‹](https://zenn.dev/mapbox_japan/articles/d9ba57ca498170#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%81%AE%E4%BD%9C%E6%88%90)ã‚’ã”å‚ç…§ãã ã•ã„ï¼‰

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ï¼ˆåŸ·ç­†æ™‚ç‚¹ã§æœ€æ–°ç‰ˆã®v0.4.3ã‚’ä½¿ç”¨ï¼‰

```shell
$ git clone https://github.com/mapbox/mapbox-maps-flutter.git -b 0.4.3
```

2. Android Studioã§é–‹ã
3. ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®š
åœ°å›³ã®èª­ã¿è¾¼ã¿ã«éš›ã—ã¦ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã¨ãªã‚‹ãŸã‚ã€ãã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ã¾ãšã€ã€ŒRunã€->ã€ŒEdit Configurations...ã€ã‚’é¸æŠã—ã¾ã™ã€‚

![run](/images/articles/8d206839a11067/run.png)

é–‹ã„ãŸãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã€ŒAdditional run args:ã€ã«ä»¥ä¸‹ã‚’å…¥åŠ›ã—ã¾ã™ï¼ˆYOUR_MAPBOX_PUBLIC_ACCESS_TOKENã®éƒ¨åˆ†ã¯ã”è‡ªèº«ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥ã‚Œã¦ãã ã•ã„ï¼‰ã€‚

```
--dart-define=ACCESS_TOKEN=YOUR_MAPBOX_PUBLIC_ACCESS_TOKEN
```

![Edit Configurations](/images/articles/8d206839a11067/edit_config.png)

4. å®Ÿè¡Œ

![sample](/images/articles/8d206839a11067/sample.png)


# ã‚µãƒ³ãƒ—ãƒ«ã‚’è¦‹ã‚‹

ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã¯`example/lib`ã®ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚

![folder](/images/articles/8d206839a11067/folder.png)

æ—©é€Ÿã„ãã¤ã‹è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## Full screen map

ã‚³ãƒ¼ãƒ‰: full_map.dart

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã¯å…¨ç”»é¢ã§åœ°å›³ã‚’è¡¨ç¤ºã—ã€ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚

| Light | Dark |
|:--|:--|
|![light](/images/articles/8d206839a11067/light.png)|![dark](/images/articles/8d206839a11067/dark.png)|

ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®`onPressed`ã‚¤ãƒ™ãƒ³ãƒˆã«å‡¦ç†ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚ç¾åœ¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’`isLight`ã¨ã„ã†ã‚¹ãƒ†ãƒ¼ãƒˆã§ç®¡ç†ã—ã€ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ãƒˆã«å¿œã˜ã¦Light/Darkã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã®ã¯`MapboxMap#loadStyleURI`ã§ã™ã€‚å¼•æ•°ã¯`String`ã§ã™ãŒã€ã“ã“ã§ã¯`static const String LIGHT = "mapbox://styles/mapbox/light-v10";`ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹å®šæ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€Studioã§ä½œæˆã—ãŸç‹¬è‡ªã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚‚è¨­å®šå¯èƒ½ã§ã™ã€‚

```Dart
FloatingActionButton(
    child: Icon(Icons.swap_horiz),
    heroTag: null,
    onPressed: () {
      setState(
        () => isLight = !isLight,
      );
      if (isLight) {
        mapboxMap?.loadStyleURI(MapboxStyles.LIGHT);
      } else {
        mapboxMap?.loadStyleURI(MapboxStyles.DARK);
      }
    }),
```

##  Point Annotation

ã‚³ãƒ¼ãƒ‰: point_annotations.dart

ã“ã‚Œã¯Point Annotationã®ä½¿ã„æ–¹ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚
![Point Annotation](/images/articles/8d206839a11067/point_annotation.png)

### Point Annotationã£ã¦ï¼Ÿ

åœ°å›³ä¸Šã«ãƒãƒ¼ã‚«ãƒ¼ã‚’ç½®ãæ©Ÿèƒ½ã§ã™ã€‚ãƒãƒ¼ã‚«ãƒ¼ã¨ã¯ä»¥ä¸‹ã®ä¾‹ã®é’ã„ãƒ”ãƒ³ã®ãƒãƒ¼ã‚¯ã®ã“ã¨ã§ã™ã€‚ãƒ”ãƒ³ã ã‘ã§ã¯ãªãä»»æ„ã®ç”»åƒã‚’ãƒãƒ¼ã‚«ãƒ¼ã¨ã—ã¦ä½¿ç”¨å¯èƒ½ã§ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/PoydKyo)

ãŸã ã—ã€Mapbox GL JSã®ãƒãƒ¼ã‚«ãƒ¼ãŒHTMLã®ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚’åœ°å›³ã«é‡ã­ã¦è¡¨ç¤ºã—ã¦ã„ã‚‹ã®ã«å¯¾ã—ã€Point Annotationã¯åœ°å›³ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã¨ã„ã†é•ã„ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€Mapbox GL JSã®ãƒãƒ¼ã‚«ãƒ¼ãŒä»»æ„ã®HTMLãŒè¡¨ç¤ºå¯èƒ½ã§ã‚ã‚‹ã®ã«å¯¾ã—ã€Point Annotationã¯ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦è¡¨ç¤ºå¯èƒ½ãªç”»åƒã®ã¿ãŒä½¿ç”¨å¯èƒ½ã§ã™ã€‚

Mapbox Maps SDK for Android/iOSã«ã¯Mapbox GL JSç›¸å½“ã®View Annotationã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯[Androidã®`View`](https://docs.mapbox.com/android/maps/guides/annotations/view-annotations/)ã€[iOSã®`UIView`](https://docs.mapbox.com/ios/maps/guides/annotations/view-annotations/)ã‚’ãƒãƒ¼ã‚«ãƒ¼ã¨ã—ã¦åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚OSãŒæä¾›ã™ã‚‹Viewã‚’ä½¿ç”¨ã§ãã‚‹ãŸã‚ã€ä»»æ„ã®ãƒãƒ¼ã‚«ãƒ¼ãŒä½¿ç”¨ã§ãã¾ã™ã€‚

ã—ã‹ã—ã€æ®‹å¿µãªãŒã‚‰Mapbox Maps SDK Flutter Pluginã§ã¯æœªå®Ÿè£…ã§ã™ã€‚Viewã®è¡¨ç¤ºä½ç½®ã‚’èª¿æ•´ã™ã‚‹ãŸã‚ã«å¤§é‡ã®ãƒ¡ã‚½ãƒƒãƒ‰ãƒãƒ£ãƒãƒ«å‘¼ã³å‡ºã—ãŒç™ºç”Ÿã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ã™ã‚‹ã“ã¨ãŒç†ç”±ã®ä¸€ã¤ã¨ã—ã¦è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã¨ã„ã†ã®ã‚‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„ã‚ºãƒ¼ãƒ ã«åˆã‚ã›ã¦Flutter Viewã®ä½ç½®ã‚’ç§»å‹•ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€åœ°å›³ä¸Šã®åº§æ¨™ã¨ç”»é¢ã®åº§æ¨™ã‚’å¤‰æ›ã™ã‚‹æ©Ÿèƒ½ãŒãƒã‚¤ãƒ†ã‚£ãƒ–ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚å®Ÿã¯ã€ä»¥å‰Flutter Mapbox GLå‘ã‘ã«ã“ã®æ©Ÿèƒ½ã‚’[å®Ÿè£…ã—ã¾ã—ãŸ](https://github.com/flutter-mapbox-gl/maps/pull/554)ã€‚ã“ã®ã¨ãã¯ãƒãƒƒãƒçš„ã«ã¾ã¨ã‚ã¦è¤‡æ•°ã®åº§æ¨™å¤‰æ›ã‚’åŒæ™‚ã«è¡Œãˆã‚‹ã‚ˆã†ãªå®Ÿè£…ã«ã—ã¾ã—ãŸã€‚ã—ã‹ã—ã€åŠ›æŠ€ãªæ„Ÿã‚‚ã‚ã‚Šã€Mapbox Maps SDK Flutter Pluginã§ã¯æ¡ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ã¾ãŸã€Mapbox Maps SDK for Android/iOSã§ã¯Point Annotationã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

@[card](https://docs.mapbox.com/android/maps/guides/annotations/)
@[card](https://docs.mapbox.com/ios/maps/guides/annotations/)

### Point Annotationã®ä½¿ã„æ–¹
ã¾ãšã€`PointAnnotationManager`ã‚’å–å¾—ã—ã¾ã™ã€‚

```Dart
mapboxMap.annotations.createPointAnnotationManager().then((value) async {
```

ãã—ã¦ã€ä¸€ã¤ä¸€ã¤ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’`PointAnnotationOptions`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ä½œæˆã—ã¾ã™ã€‚ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`PointAnnotationManager#create`ã§`PointAnnotationManager`ã«ç™»éŒ²ã—ã¦ã„ãã¾ã™ã€‚`PointAnnotationOptions`ã§æŒ‡å®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§æŒ‡å®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨åŒã˜ã§ã™ã­ã€‚

```Dart
void createOneAnnotation(Uint8List list) {
  pointAnnotationManager
      ?.create(PointAnnotationOptions(
          geometry: Point(
              coordinates: Position(
            0.381457,
            6.687337,
          )).toJson(),
          textField: "custom-icon",
          textOffset: [0.0, -2.0],
          textColor: Colors.red.value,
          iconSize: 1.3,
          iconOffset: [0.0, -5.0],
          symbolSortKey: 10,
          image: list))
    .then((value) => pointAnnotation = value);
}
```

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«è¤‡æ•°ã®`PointAnnotationOptions`ã‚’ã¾ã¨ã‚ã¦`createMulti`ã§ç™»éŒ²ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```Dart
var options = <PointAnnotationOptions>[];
for (var i = 0; i < 5; i++) {
  options.add(PointAnnotationOptions(
      geometry: createRandomPoint().toJson(), image: list));
}
pointAnnotationManager?.createMulti(options);
```

# ã¾ã¨ã‚

SDKã«åŒæ¢±ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€SDKã®ä½¿ã„æ–¹ãŒã‚ˆã‚Šç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€å†…éƒ¨ã®å®Ÿè£…ãŒã©ã†ãªã£ã¦ã„ã‚‹ã®ã‹è¿½ã„ã‹ã‘ãŸã‚Šã€æŒ™å‹•ã‚’å¤‰ãˆã¦ã¿ãŸã‚Šã™ã‚‹ã®ã‚‚é¢ç™½ã„ã§ã™ã­ã€‚