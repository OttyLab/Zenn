---
title: "Mapbox Newsletter WEEKLY TIPSã®è§£èª¬ -ã€Œãƒ›ãƒãƒ¼æ™‚ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã€"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥é…ä¿¡ã•ã‚ŒãŸMapbox Newsletterã®WEEKLY TIPSã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€Œãƒ›ãƒãƒ¼æ™‚ã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã€ã«ã¤ã„ã¦ã®è§£èª¬ã§ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯[Popup](https://docs.mapbox.com/mapbox-gl-js/api/markers/#popup)ãŠã‚ˆã³[ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ](https://docs.mapbox.com/mapbox-gl-js/api/map/#events-interaction)ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ä¾‹ç¤ºã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€Newsletterã®è³¼èª­ã¯[ã“ã¡ã‚‰](https://www.mapbox.jp/blog?#:~:text=%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%AC%E3%82%BF%E3%83%BC%E3%82%92%E8%B3%BC%E8%AA%AD)ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã€‚

ä»¥ä¸‹ãŒæœ¬ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¢ã§ã™ã€‚
@[codepen](https://codepen.io/OttyLab/pen/XWwQPpL)


# ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

ã¾ãšExamplesã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã«è¡Œãã¾ã—ã‚‡ã†ã€‚

æ—¥æœ¬èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/jp/mapbox-gl-js/example/popup-on-hover/)

è‹±èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/mapbox-gl-js/example/popup-on-hover/)

åŸºæœ¬çš„ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€è‹±èªç‰ˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒMapbox Streets v12ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã¡ã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Mapbox Streets v11ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåœ°å›³æŠ•å½±æ³•ï¼‰ãŒWebãƒ¡ãƒ«ã‚«ãƒˆãƒ«ã§ã‚ã‚‹ã®ã«å¯¾ã—ã€Mapbox Streets v12ã§ã¯Globeï¼ˆ3Dè¡¨ç¤ºã•ã‚ŒãŸåœ°çƒï¼‰ãªã®ã§ã€å°è±¡ãŒã‹ãªã‚Šç•°ãªã‚Šã¾ã™ã€‚ã¾ãŸã€è‹±èªç‰ˆã¯Mapbox GL JS v3ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

## HTML/CSS

ã¾ãšHTMLã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã¯åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

```HTML
<div id="map"></div>
```

ä»¥ä¸‹ã¯ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚`.mapboxgl-popup`ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã¯Popupã®[ã‚³ãƒ³ãƒ†ãƒŠã®div](https://github.com/mapbox/mapbox-gl-js/blob/v2.4.0/src/ui/popup.js#L551)ã‚’æŒ‡ã—ã¾ã™ã€‚

```css
.mapboxgl-popup {
  max-width: 400px;
  font:
    12px/20px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
```

## Mapã®ä½œæˆ

æ¬¡ã«JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã„ã¤ã‚‚é€šã‚Šã€Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚`container`ã§åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®idã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
const map = new mapboxgl.Map({
  container: 'map',
  // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
  style: 'mapbox://styles/mapbox/streets-v12',
  center: [-77.04, 38.907],
  zoom: 11.15
});
```

## ã‚½ãƒ¼ã‚¹ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ

ä»Šå›ã®ãƒ‡ãƒ¢ã¯äº‹å‰ã«è¤‡æ•°ã®åœ°ç‚¹ã‚’ç™»éŒ²ã—ã€ãã“ã«ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹ã¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€è¤‡æ•°åœ°ç‚¹ã‚’ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ãŠãã¾ã™ã€‚ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€`map.on('load', () => { /* ã“ã“ */})`ã®éƒ¨åˆ†ã«å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚

### ã‚½ãƒ¼ã‚¹ã®ä½œæˆ

[`Map#addSource`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addsource)ã§ã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ç¬¬1å¼•æ•°ãŒä»»æ„ã®ã‚½ãƒ¼ã‚¹IDã€ç¬¬2å¼•æ•°ãŒã‚½ãƒ¼ã‚¹ã«ãªã‚Šã¾ã™ã€‚ã“ã“ã§ã¯[GeoJSON](https://docs.mapbox.com/style-spec/reference/sources/#geojson)ã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚`FeatureCollection`ã‚’ç”¨ã„ã¦ã€è¤‡æ•°ã®Pointãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ã¦ã„ã¾ã™ã€‚

```JavaScript
map.addSource('places', {
  'type': 'geojson',
  'data': {
    'type': 'FeatureCollection',
    'features': [
      {
        'type': 'Feature',
        'properties': {
          'description':
            '<strong>Make it Mount Pleasant</strong><p>Make it Mount Pleasant is a handmade and vintage market and afternoon of live entertainment and kids activities. 12:00-6:00 p.m.</p>'
        },
        'geometry': {
          'type': 'Point',
          'coordinates': [-77.038659, 38.931567]
        }
      },
...ä¸­ç•¥...
    ]
  }
});
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
[`Map#addLayer`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addlayer)ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã“ã§ã¯[Circleãƒ¬ã‚¤ãƒ¤ãƒ¼](https://docs.mapbox.com/style-spec/reference/layers#circle)ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`source`ã¯å…ˆç¨‹ã®ã‚½ãƒ¼ã‚¹ã®IDã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
map.addLayer({
  'id': 'places',
  'type': 'circle',
  'source': 'places',
  'paint': {
    'circle-color': '#4264fb',
    'circle-radius': 6,
    'circle-stroke-width': 2,
    'circle-stroke-color': '#ffffff'
  }
});
```

## Popupã®ä½œæˆ

æ¬¡ã«ã€[`Popup`](https://docs.mapbox.com/mapbox-gl-js/api/markers/#popup)ã‚’ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ã„ã¾ã™ã€‚`closeButton: false`ã§å³ä¸Šã®âœ—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã€`closeOnClick: false`ã§ã‚¯ãƒªãƒƒã‚¯ã§Popupã‚’é–‰ã˜ã‚‹æŒ™å‹•ã‚’é˜²æ­¢ã—ã¦ã„ã¾ã™ã€‚

```JavaScript
const popup = new mapboxgl.Popup({
    closeButton: false,
    closeOnClick: false
});
```

## ãƒ›ãƒãƒ¼æ™‚ã®å‹•ä½œ

ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒCircleãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åœ°ç‚¹ä¸Šã«æ¥ãŸã¨ãã«Popupã‚’è¡¨ç¤ºã™ã‚‹ã®ãŒç›®æ¨™ã§ã™ã€‚ãã“ã§ã“ã“ã§ã¯[`mouseenter`ã‚¤ãƒ™ãƒ³ãƒˆ](https://docs.mapbox.com/mapbox-gl-js/api/map/#map.event:mouseenter)ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚`map.on('mouseenter', ãƒ¬ã‚¤ãƒ¤ãƒ¼ID, () => { /* ã“ã“ */})`ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™ã€‚ç¬¬2å¼•æ•°ã«ç›£è¦–å¯¾è±¡ã¨ã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®IDã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒãã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡¨ç¤ºé ˜åŸŸã«å…¥ã‚‹ã¨ã€Œã“ã“ã€ã®å‡¦ç†ãŒç™ºç«ã—ã¾ã™ã€‚

å‡¦ç†å†…å®¹ã‚’ç¢ºèªã—ã¾ã™ã€‚

ã¾ãšã€ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®å½¢çŠ¶ã‚’å¤‰ãˆã¦ã„ã¾ã™ã€‚
```JavaScript
// Change the cursor style as a UI indicator.
map.getCanvas().style.cursor = 'pointer';
```

ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å¼•æ•°`e`ã¯[`MapMouseEvent`](https://docs.mapbox.com/mapbox-gl-js/api/events/#mapmouseevent)ã§ã™ã€‚ãã®ä¸­ã®[`features`](https://docs.mapbox.com/mapbox-gl-js/api/events/#mapmouseevent#features)ã¯ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ·ããŸã¨ãã®ãã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã“ã§ã€åº§æ¨™ã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

```JavaScript
// Copy coordinates array.
const coordinates = e.features[0].geometry.coordinates.slice();
const description = e.features[0].properties.description;
```

ä»¥ä¸‹ã®å‡¦ç†ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåœ°å›³æŠ•å½±æ³•ï¼‰ãŒ`mercator`ã®ã¨ãã«ã¯å¿…è¦ãªå‡¦ç†ã§ã™ã€‚
```JavaScript
// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
    coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
}
```

`mercator`ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ¨ªæ–¹å‘ã«åœ°å›³ãŒç¹°ã‚Šè¿”ã—è¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ä¸Šè¨˜å‡¦ç†ãŒãªã„ã¨å³ã®Circleã«ãƒãƒ¼ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ãŸã¨ãã«å·¦å´ã«PopupãŒå‡ºã¦ã—ã¾ã„ã¾ã™ã€‚
![mercator](/images/articles/08f18ea131656c/mercator.png)

ãŸã ã—ã€Mapbox Streets v12ã§ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåœ°å›³æŠ•å½±æ³•ï¼‰ã¯`globe`ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚ã‚Šã€ã“ã®å‡¦ç†ã¯ä¸è¦ã§ã™ã€‚ãã“ã§ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚‚å‰Šé™¤ã™ã‚‹ã“ã¨ãŒæ¤œè¨ã•ã‚Œã¦ã„ã¾ã™ã€‚


æœ€å¾Œã«Popupã®è¡¨ç¤ºã™ã‚‹åº§æ¨™ã€å†…å®¹ã‚’è¨­å®šã—ã¦Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«[`addTo`](https://docs.mapbox.com/mapbox-gl-js/api/markers/#popup#addto)ã™ã‚‹ã“ã¨ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```JavaScript
// Populate the popup and set its coordinates
// based on the feature found.
popup.setLngLat(coordinates).setHTML(description).addTo(map);
```

## ãƒã‚¦ã‚¹ã‚¢ã‚¦ãƒˆæ™‚ã®å‹•ä½œ

ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãŒCircleãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰å¤–ã‚ŒãŸã¨ãã¯[`mouseleave`ã‚¤ãƒ™ãƒ³ãƒˆ](https://docs.mapbox.com/mapbox-gl-js/api/map/#map.event:mouseleave)ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã€[`Popup#rempve`](https://docs.mapbox.com/mapbox-gl-js/api/markers/#popup#remove)ã§Popupã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```JavaScript
map.on('mouseleave', 'places', () => {
    map.getCanvas().style.cursor = '';
    popup.remove();
});
```


# ã¾ã¨ã‚
Popupã¯Markerã¨ã„ã£ã—ã‚‡ã«ä½¿ã†ã“ã¨ãŒå¤šã„ã§ã™ãŒã€å˜ç‹¬ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ã¾ãŸã€ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®æ‰±ã„æ–¹ã«ã¤ã„ã¦ã‚‚ç¢ºèªã—ã¾ã—ãŸã€‚
