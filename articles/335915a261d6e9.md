---
title: "maplibre-gl-opacityã‚’Mapbox GL JSã§ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript", "SoftwareDesign"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ç¾åœ¨ã€Software Designã§é€£è¼‰ä¸­ã®ã€Œä½ç½®æƒ…å ±ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®ã™ã™ã‚ã€ã‚’æ¯æœˆæ¥½ã—ãæ‹èª­ã—ã¦ãŠã‚Šã¾ã™ã€‚ç¬¬6å›ã€Œé˜²ç½ãƒãƒƒãƒ—ã®ä½œæˆâ‘  æµ¸æ°´æƒ³å®šåŒºåŸŸã¨é¿é›£æ‰€ã‚’å¯è¦–åŒ–ã™ã‚‹ã€ã§ã¯[MapLibre GL JS](https://maplibre.org/)ã‚’ç”¨ã„ã¦åœ°ç†æƒ…å ±ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã—ãŸã€‚è¨˜äº‹ã«ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã€MapLibre GL JSã¯Mapbox GL JSã‹ã‚‰ãƒ•ã‚©ãƒ¼ã‚¯ã•ã‚ŒãŸåœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã®ã§ã€ä½¿ã„æ–¹ã¯éå¸¸ã«ä¼¼é€šã£ã¦ã„ã¾ã™ã€‚ãã“ã§ã€ã“ã“ã§ã¯ç´™é¢ã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸMapLibre GL JSç”¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹maplibre-gl-opacityã‚’Mapbox GL JSã§ä½¿ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚


# maplibre-gl-opacityã¨ã¯

[maplibre-gl-opacity](https://github.com/mug-jp/maplibre-gl-opacity/)ã¯MapLibre GL JSç”¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã€ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºè¨­å®šã‚„ä¸é€æ˜åº¦ã®è¨­å®šã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ä½œè€…æ§˜ã®è§£èª¬è¨˜äº‹ã¯ä»¥ä¸‹ã§ã™ã€‚

https://qiita.com/dayjournal/items/2200ce37472c3b4cd6f3


# maplibre-gl-opacityã®ä½¿ã„æ–¹

maplibre-gl-opacityã¯[`IControl`](https://maplibre.org/maplibre-gl-js/docs/API/interfaces/maplibregl.IControl/)ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«`OpacityControl`ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€[`Map#addControl`](https://maplibre.org/maplibre-gl-js/docs/API/classes/maplibregl.Map/#addcontrol)ã§åœ°å›³ä¸Šã«è¡¨ç¤ºã—ã¾ã™ã€‚

```JavaScript
const opacity = new OpacityControl({
  baseLayers: {
    'tokyo-st-green': 'GREEN',
    'tokyo-st-blue': 'BLUE',
  },
  overLayers: {
    satellite: 'Satellite',
  },
  opacityControl: true,
});

map.addControl(opacity, 'top-left');
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`baseLayers`ã§æŒ‡å®šã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯æŠä¸€å¼ã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã€`overLayers`ã§æŒ‡å®šã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯è¤‡æ•°é¸æŠå¯èƒ½ãªãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã¾ãŸã€`opacityControl`ã‚’`true`ã¨ã™ã‚‹ã“ã¨ã§`overLayers`ã®ä¸é€æ˜åº¦ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![control](/images/articles/335915a261d6e9/control.png)


# maplibre-gl-opacityã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€

`IControl`ã¯`Map#addControl`ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§`onAdd`é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€`Icontrol`ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¯`onAdd`é–¢æ•°ãªã®ã§ã€ã“ã“ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã¨è‰¯ã„ã§ã™ã€‚

https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L131-L136


`_opacityControlAdd()`é–¢æ•°ãŒå†…éƒ¨ã§å‘¼ã°ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ä¸­ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

## `baseLayers`ã«é–¢ã™ã‚‹å‡¦ç†
ä»¥ä¸‹ã§`baseLayers`ã«é–¢ã™ã‚‹å‡¦ç†ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚`baseLayers`ã¯ã‚­ãƒ¼ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼IDãªã®ã§ã€`Object.keys`ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã®é…åˆ—ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚ãã®é…åˆ—ã«å¯¾ã—ã¦`map`ã‚’ä½œç”¨ã•ã›ã€å„ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã‚’å¼•æ•°ã¨ã—ã¦`_radioButtonControlAdd`é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L99-L108

`_radioButtonControlAdd`ã§ã¯ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚ã•ã‚‰ã«ã€1ã¤ç›®ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å¯¾ã—ã¦ã¯[`Map#setLayoutProperty`](https://maplibre.org/maplibre-gl-js/docs/API/classes/maplibregl.Map/#setlayoutproperty)ã‚’ä½¿ç”¨ã—ã€`visibility`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’`visible`ã«ã€ãã‚Œä»¥å¤–ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯`none`ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L20-L30

ã•ã‚‰ã«ã€ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¸æŠæ™‚ã«ã€é¸æŠã•ã‚ŒãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’`visible`ã«ã™ã‚‹å‡¦ç†ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L33-L44

ã¾ãŸã€`baseLayers`ã®å€¤ã¯ãƒ©ãƒ™ãƒ«ã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L48

## `overLayers`ã«é–¢ã™ã‚‹å‡¦ç†
ä»¥ä¸‹ã§`overLayers`ã«é–¢ã™ã‚‹å‡¦ç†ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚`overLayers`ã‚‚ã‚­ãƒ¼ãŒãƒ¬ã‚¤ãƒ¤ãƒ¼IDãªã®ã§ã€`Object.keys`ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã®é…åˆ—ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚ãã®é…åˆ—ã«å¯¾ã—ã¦`map`ã‚’ä½œç”¨ã•ã›ã€å„ãƒ¬ã‚¤ãƒ¤ãƒ¼IDã‚’å¼•æ•°ã¨ã—ã¦`_checkBoxControlAdd`é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L114-L128

`_checkBoxControlAdd`é–¢æ•°ã§ã¯ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ã•ã‚‰ã«ã€å…¨ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’éè¡¨ç¤ºçŠ¶æ…‹ã«ã—ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L54-L59

ã¾ãŸã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é¸æŠæ™‚ã«è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‡¦ç†ãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L62-L69

`opacityControl`ãŒ`true`ã®ã¨ãã«ã¯`_rangeControlAdd`é–¢æ•°ã‚‚å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L123-L126

`_rangeControlAdd`é–¢æ•°ã§ã¯ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä½œæˆã—ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼å¤‰æ›´æ™‚ã«[`Map#setPaintProperty`](https://maplibre.org/maplibre-gl-js/docs/API/classes/maplibregl.Map/#setpaintproperty)ã§[`raster-opacity`](https://maplibre.org/maplibre-style-spec/layers/#paint-raster-raster-opacity)ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L86-L90

`raster-opacity`ã¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼å°‚ç”¨ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãªã®ã§ã€`opacityControl`ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«`overLayers`ã«æŒ‡å®šã§ãã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã¿ã¨ãªã‚Šã¾ã™ã€‚


# maplibre-gl-opacityã‚’Mapbox GL JSã§ä½¿ã†

ä¸Šè¨˜ã§ã¯maplibre-gl-opacityå†…éƒ¨ã§ä½¿ç”¨ã•ã‚Œã‚‹MapLibre GL JSã®æ©Ÿèƒ½ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚ä»¥ä¸‹ã®è¡¨ã¯MapLibre GL JSã¨Mapbox GL JSã®æ©Ÿèƒ½ã‚’æ¯”è¼ƒã§ã™ã€‚ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯Mapbox GL JS v1.13.0ä»¥å‰ã«å®Ÿè£…ã•ã‚ŒãŸã‚‚ã®ãªã®ã§ã€åŸºæœ¬çš„ã«äº’æ›æ€§ãŒã‚ã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¾ã™ã€‚

| MapLibre GL JS | Mapbox GL JS |
|:--|:--|
|[`IControl`](https://maplibre.org/maplibre-gl-js/docs/API/interfaces/maplibregl.IControl/)|[`IControl`](https://docs.mapbox.com/mapbox-gl-js/api/markers/#icontrol)|
|[`Map#addControl`](https://maplibre.org/maplibre-gl-js/docs/API/classes/maplibregl.Map/#addcontrol)|[`Map#addControl`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#addcontrol)|
|[`Map#setLayoutProperty`](https://maplibre.org/maplibre-gl-js/docs/API/classes/maplibregl.Map/#setlayoutproperty)|[`Map#setLayoutProperty`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#setlayoutproperty)|
|[`Map#setPaintProperty`](https://maplibre.org/maplibre-gl-js/docs/API/classes/maplibregl.Map/#setpaintproperty)|[`Map#setPaintProperty`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#setpaintproperty)|

## ã‚µãƒ³ãƒ—ãƒ«å…¨ä½“
ã¾ãšä»Šå›ä½œæˆã—ãŸã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚

```JavaScript
import { Map } from 'mapbox-gl';
import 'mapbox-gl/dist/mapbox-gl.css';
// @ts-ignore
import OpacityControl from 'maplibre-gl-opacity';
import 'maplibre-gl-opacity/dist/maplibre-gl-opacity.css'

import tokyoSt from './tokyo_st.json'

const map = new Map({
    accessToken: 'YOUR_MAPBOX_ACCESS_TOKEN',
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [139.768435, 35.681054],
    zoom: 15,
});

map.on('style.load', () => {
  map.addSource('tokyo-st', {
    type: 'geojson',
    data: tokyoSt as any,
  });

  map.addLayer({
    'id': 'tokyo-st-green',
    'type': 'fill',
    'source': 'tokyo-st',
    'paint': {
      'fill-color': '#00ff00',
    }
  });

  map.addLayer({
    'id': 'tokyo-st-blue',
    'type': 'fill',
    'source': 'tokyo-st',
    'paint': {
      'fill-color': '#0000ff',
    }
  });

  map.addSource('satellite', {
    'type': 'raster',
    'url': 'mapbox://mapbox.satellite',
  });

  map.addLayer({
    'id': 'satellite',
    'type': 'raster',
    'source': 'satellite',
  });

  const opacity = new OpacityControl({
    baseLayers: {
      'tokyo-st-green': 'GREEN',
      'tokyo-st-blue': 'BLUE',
    },
    overLayers: {
      satellite: 'Satellite',
    },
    opacityControl: true,
  });

  map.addControl(opacity, 'top-left');
  opacity._container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
});
```

ä»¥ä¸‹ã§å„éƒ¨åˆ†ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚

## åœ°å›³ã®ä½œæˆ
ä»¥ä¸‹ã§ã¯Mapã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ã„ã¾ã™ã€‚

```JavaScript
const map = new Map({
    accessToken: 'YOUR_MAPBOX_ACCESS_TOKEN',
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [139.768435, 35.681054],
    zoom: 15,
});

```

## ã‚½ãƒ¼ã‚¹ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
ã‚½ãƒ¼ã‚¹ãƒ»ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆã¯`map.on('style.load', () => { /* ã“ã“ */})`ã®éƒ¨åˆ†ã§è¡Œã„ã¾ã™ã€‚

ä»¥ä¸‹ã¯æ±äº¬é§…ã®ãƒãƒªã‚´ãƒ³ã‚’GeoJSONã‹ã‚‰èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ã¾ãŸã€ãƒãƒªã‚´ãƒ³ã‚’ç·‘è‰²ã§å¡—ã‚Šã¤ã¶ã—ãŸ`tokyo-st-green`ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ãƒãƒªã‚´ãƒ³ã‚’é’è‰²ã§å¡—ã‚Šã¤ã¶ã—ãŸ`tokyo-st-blue`ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯`baseLayers`ã§ä½¿ç”¨ã—ã¾ã™ã€‚

```JavaScript
  map.addSource('tokyo-st', {
    type: 'geojson',
    data: tokyoSt as any,
  });

  map.addLayer({
    'id': 'tokyo-st-green',
    'type': 'fill',
    'source': 'tokyo-st',
    'paint': {
      'fill-color': '#00ff00',
    }
  });

  map.addLayer({
    'id': 'tokyo-st-blue',
    'type': 'fill',
    'source': 'tokyo-st',
    'paint': {
      'fill-color': '#0000ff',
    }
  });
```

ä»¥ä¸‹ã¯Mapboxã®[Satellite Tileset](https://docs.mapbox.com/data/tilesets/reference/mapbox-satellite/)ã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚ã¾ãŸã€ã“ã®ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆã¯ãƒ©ã‚¹ã‚¿ãƒ¼ãªã®ã§ã€ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯`overLayers`ã§ä½¿ç”¨ã—ã¾ã™ã€‚

```JavaScript
  map.addSource('satellite', {
    'type': 'raster',
    'url': 'mapbox://mapbox.satellite',
  });

  map.addLayer({
    'id': 'satellite',
    'type': 'raster',
    'source': 'satellite',
  });
```

## maplibre-gl-opacityã®ä½œæˆ
maplibre-gl-opacityã®ä½¿ã„æ–¹ã§è¦‹ãŸé€šã‚Šã€`OpacityControl`ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€`addControl`ã—ã¾ã™ã€‚

```JavaScript
  const opacity = new OpacityControl({
    baseLayers: {
      'tokyo-st-green': 'GREEN',
      'tokyo-st-blue': 'BLUE',
    },
    overLayers: {
      satellite: 'Satellite',
    },
    opacityControl: true,
  });

  map.addControl(opacity, 'top-left');
```

æœ€å¾Œã«ã¡ã‚‡ã£ã¨ã—ãŸãƒãƒƒã‚¯ã§ã™ã€‚Mapbox GL JSã§ä½¿ç”¨ã™ã‚‹éš›ã«å¿…è¦ãªã‚¯ãƒ©ã‚¹åã®æŒ‡å®šã‚’è¡Œã„ã¾ã™ã€‚
```JavaScript
  opacity._container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
```

ã“ã®æŒ‡å®šã®èƒŒæ™¯ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

maplibre-gl-opacityã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã€`maplibregl-ctrl`ãŠã‚ˆã³`maplibregl-ctrl-group`ã¨ã„ã†ã‚¯ãƒ©ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/mug-jp/maplibre-gl-opacity/blob/v1.6.0/src/maplibre-gl-opacity.js#L93-L98

ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã¯ä»¥ä¸‹ã®æ§˜ã«MapLibre GL JSã®CSSã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚`IControl`ã§ä½œæˆã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã«å¯¾ã—ã¦ã“ã®ã‚¯ãƒ©ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã§ã€ã„ã„æ„Ÿã˜ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
https://github.com/maplibre/maplibre-gl-js/blob/v2.4.0/src/css/maplibre-gl.css#L87-L94
https://github.com/maplibre/maplibre-gl-js/blob/v2.4.0/src/css/maplibre-gl.css#L108-L112

åŒæ§˜ã®ã‚¯ãƒ©ã‚¹ãŒMapbox GL JSã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/mapbox/mapbox-gl-js/blob/v3.0.1/src/css/mapbox-gl.css#L63-L69
https://github.com/mapbox/mapbox-gl-js/blob/v3.0.1/src/css/mapbox-gl.css#L63-L69

ãã“ã§ã€Mapbox GL JSã§ä½¿ç”¨ã™ã‚‹å ´åˆã«ã¯`maplibregl-ctrl`ã‚’`mapboxgl-ctrl`ã«ã€ `maplibregl-ctrl-group`ã‚’`mapboxgl-ctrl-group`ã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


# çµæœ

ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![result](/images/articles/335915a261d6e9/result.png)

ãƒ‡ãƒ¢ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã§è©¦ã›ã¾ã™ã€‚
https://sd202312.netlify.app/opacity

# ã¾ã¨ã‚

ã¡ã‚‡ã£ã¨ã—ãŸãƒãƒƒã‚¯ã¯å¿…è¦ã§ã—ãŸãŒã€maplibre-gl-opacity(v1.6.0)ãŒMapbox GL JS(v3.0.1)ã§ã‚‚ä½¿ç”¨ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚ãŸã ã—ã€ä»Šå¾ŒMapLibre GL JSã®ç‹¬è‡ªæ©Ÿèƒ½ã‚’ä½¿ã†å¤‰æ›´ãŒåŠ ãˆã‚‰ã‚ŒãŸã‚Šã€MapLibre Gl JSã¾ãŸã¯Mapbox GL GLã®æ—¢å­˜æ©Ÿèƒ½ã«ç ´å£Šçš„å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã«ã¯ä½¿ç”¨ã§ããªããªã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚

`OpacityControl`ã®è¨­å®šã«é–¢ã—ã¦ã€`baseLayers`ã¨ã„ã†åç§°ã‹ã‚‰ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½¿ç”¨ãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ã®æœŸå¾…å€¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ä»Šå›ã®ã‚ˆã†ãªä»»æ„ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡¨ç¤ºã®é¸æŠã«ã‚‚åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

ã¾ãŸã€ç´™é¢ã§ã¯`OpacityControl`ã‚’2ã¤ä½œæˆã—ã¦ã„ã¾ã—ãŸãŒã€ä¸€ã¤ã¯ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ã®é¸æŠç”¨ã€ã‚‚ã†ä¸€ã¤ã¯æµ¸æ°´æƒ³å®šåŒºåŸŸã®é¸æŠç”¨ã¨ã—ã¦ä½œæˆã—ã¦ã„ã‚‹ã¨æ¨å¯Ÿã•ã‚Œã¾ã™ã€‚ä¸€ã¤ã®`OpacityControl`ã«å¯¾ã—ã€å¾Œè€…ã‚’`overLayers`ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹ä½¿ã„æ–¹ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚


# ãŠã¾ã‘

ç´™é¢ã§ä»¥ä¸‹ã®ã‚ˆã†ãªè„šæ³¨ãŒã‚ã‚Šã¾ã—ãŸã€‚
> æ³¨5) MapLibre GL JSã¯v3ã‹ã‚‰ä¸€éƒ¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ©Ÿèƒ½ã—ãªã„å•é¡ŒãŒã‚ã‚‹ãŸã‚ã€æœ¬é€£è¼‰ã§ã¯æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ãªãå‹•ä½œãŒå®‰å®šã—ã¦ã„ã‚‹v2.4.0ã‚’ä½¿ã„ã¾ã™ã€‚
> https://github.com/maplibre/maplibre-gl-js/blob/main/CHANGELOG.md#potentially-breaking-changes

ãƒªãƒ³ã‚¯å…ˆã‚’ç¢ºèªã™ã‚‹ã¨Potentially breaking changesã¨ã—ã¦ä»¥ä¸‹ã®é …ç›®ãŒã‚ã‚Šã¾ã™ã€‚
> âš ï¸ Remove deprecated mapboxgl- css classes (use maplibregl- instead) (#1575)


maplibre-gl-opacityã¯v1.5.0ã§ã‚¯ãƒ©ã‚¹ã‚’`maplibregl-ctrl`ã€`maplibregl-ctrl-group`ã«[å¤‰æ›´ã—ã¦ã„ã‚‹](https://github.com/mug-jp/maplibre-gl-opacity/pull/4)ã®ã§å•é¡Œãªã„ã§ã™ãŒã€Mapbox GL JSç”¨ã«é–‹ç™ºã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ä½¿ãˆãªããªã£ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚