---
title: "Mapbox Newsletter WEEKLY TIPSã®è§£èª¬ -ã€Œexpressionã‚’ä½¿ç”¨ã—ã¦ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã€"
emoji: "ğŸŒˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥é…ä¿¡ã•ã‚ŒãŸMapbox Newsletterã®WEEKLY TIPSã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€Œexpressionã‚’ä½¿ç”¨ã—ã¦ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆã€ã«ã¤ã„ã¦ã®è§£èª¬ã§ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯Expressionsã‚’ä½¿ã£ã¦LineStringã®è‰²ã‚’ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹æ–¹æ³•ã‚’ä¾‹ç¤ºã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€Newsletterã®è³¼èª­ã¯[ã“ã¡ã‚‰](https://www.mapbox.jp/blog?#:~:text=%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%AC%E3%82%BF%E3%83%BC%E3%82%92%E8%B3%BC%E8%AA%AD)ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã€‚

ä»¥ä¸‹ãŒæœ¬ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¢ã§ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/KKJVXQB)


# ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

ã¾ãšExamplesã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã«è¡Œãã¾ã—ã‚‡ã†ã€‚

æ—¥æœ¬èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/jp/mapbox-gl-js/example/line-gradient/)

è‹±èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/mapbox-gl-js/example/line-gradient/)

åŸºæœ¬çš„ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€è‹±èªç‰ˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒMapbox Light v11ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã¡ã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Mapbox Light v10ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒWebãƒ¡ãƒ«ã‚«ãƒˆãƒ«ã§ã‚ã‚‹ã®ã«å¯¾ã—ã€Mapbox Light v11ã§ã¯Globeï¼ˆ3Dè¡¨ç¤ºã•ã‚ŒãŸåœ°çƒï¼‰ãªã®ã§ã€å°è±¡ãŒã‹ãªã‚Šç•°ãªã‚Šã¾ã™ã€‚

## HTML/CSS

ã¾ãšHTMLã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã¯åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

```HTML
<div id="map"></div>
```

## Mapã®ä½œæˆ

æ¬¡ã«JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã„ã¤ã‚‚é€šã‚Šã€Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚`container`ã§åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®idã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
const map = new mapboxgl.Map({
  container: 'map',
  // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
  style: 'mapbox://styles/mapbox/light-v11',
  center: [-77.035, 38.875],
  zoom: 12
});
```

## GeoJSONã®ä½œæˆ

ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ç·šã‚’å¼•ãã®ã§ã€LineStringã®ãƒ‡ãƒ¼ã‚¿ã‚’GeoJSONã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚

```JavaScript
const geojson = {
  'type': 'FeatureCollection',
  'features': [
    {
      'type': 'Feature',
      'properties': {},
      'geometry': {
      'coordinates': [
        [-77.044211, 38.852924],
        [-77.045659, 38.860158],
        ...
      ],
      'type': 'LineString'
      }
    }
  ]
};
```

## ã‚½ãƒ¼ã‚¹ã®è¿½åŠ 
`map.on('load', () => {}`ã®ä¸­èº«ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ä»¥ä¸‹ã®éƒ¨åˆ†ã§ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚å…ˆã»ã©ä½œæˆã—ãŸGeoJSONã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚[`lineMetrics`](https://docs.mapbox.com/style-spec/reference/sources/#geojson-lineMetrics)ã‚’`true`ã«è¨­å®šã—ã¦ãŠã‹ãªã„ã¨`Error: layers.line: layer "line" specifies a line-gradient, which requires a GeoJSON source with lineMetrics enabled.`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

```JavaScript
map.addSource('line', {
  type: 'geojson',
  lineMetrics: true,
  data: geojson
});
```

## ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ 
æ¬¡ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ ã§ã™ã€‚ã“ã“ã§ã„ã‚ˆã„ã‚ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç™»å ´ã§ã™ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å½¹å‰²ã¯è¦‹ãŸç›®ï¼ˆè‰²ã‚„å½¢ï¼‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãªã®ã§ã€ã“ã“ã§ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºã¦ãã‚‹ã®ã¯ç´å¾—ã§ã™ã­ã€‚

ã¾ãšã¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**ä»¥å¤–**ã®éƒ¨åˆ†ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ç·šã‚’å¼•ãã®ã¦`type`ã¯`line`ã€`source`ã¯ã•ãã»ã©ã—ãŸã‚½ãƒ¼ã‚¹ã®IDã§ã‚ã‚‹`line`ã‚’æŒ‡å®šã—ã¾ã™ã€‚`paint`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²ã¨ã—ã¦`'line-color': 'red'`ã€å¤ªã•ã‚’`'line-width': 14`ã¨ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`layout`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯[`'line-cap': 'round'`](https://docs.mapbox.com/style-spec/reference/layers/#layout-line-line-cap)ã§ç·šã®å§‹ç‚¹ã¨çµ‚ç‚¹ã‚’ä¸¸ãã€[`'line-join': 'round`](https://docs.mapbox.com/style-spec/reference/layers/#layout-line-line-join)ã§ç·šã®ã‚«ãƒ‰ã‚’ä¸¸ãã—ã¦ã„ã¾ã™ã€‚

```JavaScript
map.addLayer({
  type: 'line',
  source: 'line',
  id: 'line',
  paint: {
    'line-color': 'red',
    'line-width': 14,
    // 'line-gradient' must be specified using an expression
    // with the special 'line-progress' property
    'line-gradient': [
      ...
    ]
  },
  layout: {
    'line-cap': 'round',
    'line-join': 'round'
  }
});
```

ãã—ã¦ä»¥ä¸‹ãŒ[ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³](https://docs.mapbox.com/style-spec/reference/layers/#paint-line-line-gradient)ã§ã™ã€‚ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯[Expressions](https://docs.mapbox.com/style-spec/reference/expressions/)ã§æŒ‡å®šã—ã¾ã™ã€‚Expressionsã¯JSONã®é…åˆ—ã§è¡¨ç¾ã™ã‚‹å¼ã§`["op", "param1", ...]`ã¨ã„ã†å½¢å¼ã‚’å–ã‚Šã¾ã™ã€‚é…åˆ—ã®è¦ç´ 0ãŒå‘½ä»¤ã€ãã‚Œä»¥é™ãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚ã¡ã‚‡ã†ã©Lispè¨€èªã®Så¼ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```JavaScript
    'line-gradient': [
      'interpolate',
      ['linear'],
      ['line-progress'],
      0,
      'blue',
      0.1,
      'royalblue',
      0.3,
      'cyan',
      0.5,
      'lime',
      0.7,
      'yellow',
      1,
      'red'
    ]
```

[`interpolate`](https://docs.mapbox.com/style-spec/reference/expressions/#interpolate)ã¯è£œé–“ã«é–¢ã™ã‚‹Expressionsã§ã™ã€‚ç¬¬ä¸€å¼•æ•°ãŒtypeã§`linear`ãªã‚‰ç·šå½¢è£œé–“ã€`exponential`ãªã‚‰æŒ‡æ•°çš„ãªè£œé–“ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã¯`linear`ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ç·šå½¢è£œé–“ã§ã™ã€‚

ç¬¬äºŒå¼•æ•°ãŒã€Œå€¤ã€ã®ä¾›çµ¦æºã®æŒ‡å®šã§ã™ã€‚ã“ã®ã€Œå€¤ã€ã«å¿œã˜ã¦ä»¥é™ã§æŒ‡å®šã™ã‚‹è‰²ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã¯[`line-progress`](https://docs.mapbox.com/style-spec/reference/expressions/#line-progress)ã¨ã„ã†ExpressionsãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯Lineã®å§‹ç‚¹ã‹ã‚‰ã©ã‚Œãã‚‰ã„ã®å ´æ‰€ã‹ã‚’è¿”ã—ã¾ã™ã€‚å§‹ç‚¹ãŒ`0`ã€çµ‚ç‚¹ãŒ`1`ã§ã™ã€‚

ä¸€èˆ¬ã«`interpolate`ã®ç¬¬äºŒå¼•æ•°ã«ã¯ã€`['get', ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å]`ã¨è¨˜è¿°ã™ã‚‹ã™ã‚‹ã“ã¨ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¿œã˜ã¦`line-color`ã‚’å¤‰ãˆã‚‹ã¨ã„ã†ã‚ˆã†ãªä½¿ã„æ–¹ã‚’ã—ã¾ã™ã€‚ã—ã‹ã—`line-gradient`ã§ã¯ã“ã®ã‚ˆã†ãªä½¿ã„æ–¹ã¯ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã¯[ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã‚¿ã‚¤ãƒ—](https://github.com/mapbox/mapbox-gl-js/blob/v2.15.0/src/style-spec/reference/v8.json#L5097)ã«ã‚ˆã‚Šæ±ºã¾ã£ã¦ã„ã¾ã™ã€‚

ç¬¬ä¸‰å¼•æ•°ä»¥é™ãŒã€Œå€¤ã€ã€Œå‡ºåŠ›ã€ã®çµ„ã§ã™ã€‚ã“ã“ã§ã¯`0`ï¼ˆå§‹ç‚¹ï¼‰ãŒ`blue`ã€`0.1`ï¼ˆ10%åœ°ç‚¹ï¼‰ã§`royalblue`â€¦`1`ï¼ˆçµ‚ç‚¹ï¼‰ãŒ`red`ã§ã™ã€‚

ã¡ãªã¿ã«ã€`line-gradient`ã®ã‚½ãƒ¼ã‚¹ã«ä½¿ç”¨ã§ãã‚‹ã®ã¯[GeoJSON](https://github.com/mapbox/mapbox-gl-js/blob/v2.15.0/src/style-spec/validate/validate_layer.js#L84)ã®ã¿ã§ã™ã€‚Vector Tilesetã§ã¯LineStringå…¨ä½“ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã¨ã¯é™ã‚‰ãšã€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¨ˆç®—ã§ããªã„ã‹ã‚‰ã§ã¯ãªã„ã‹ã¨æ¨å¯Ÿã—ã¾ã™ã€‚


# ã¾ã¨ã‚

Lineã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯``line-progress``ã‚’ä½¿ã†ã¨ã„ã†ã“ã¨ãŒãƒã‚¤ãƒ³ãƒˆã§ã—ãŸã€‚`lineMetrics`ã®æŒ‡å®šã‚‚å¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚