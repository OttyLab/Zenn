---
title: "Mapbox Search JS ã‚’è§¦ã£ã¦ã¿ã‚‹ (SearchBox/Core + Minimapç·¨)"
emoji: "ğŸ—ºï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript", "react"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯[Mapbox Search JS ã‚’è§¦ã£ã¦ã¿ã‚‹ (SearchBox/Reactç·¨)](https://zenn.dev/ottylab/articles/ab629f6696e865/)ã®ç¶šãã§ã€Search JSã®SearchBox/Coreã®ä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚Search Box - Search Sessionã®[SearchSessionã®Example](https://docs.mapbox.com/mapbox-search-js/api/core/search_session/#searchsession-example)ã‚’å‚è€ƒã«ã—ã¤ã¤ã€ä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ä»¥ä¸‹ãŒæœ¬ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¢ã§ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«åœ°åã‚„ä½æ‰€ã‚’å…¥ã‚Œã¦Suggestãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚æ¬¡ã«Selectãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚ŒãŸå€™è£œã‹ã‚‰ä¸€ã¤é¸æŠã™ã‚‹ã“ã¨ã§åœ°å›³ãŒè¡¨ç¤ºã•ã‚Œã€ãã®å ´æ‰€ãŒãƒãƒ¼ã‚«ãƒ¼ã§ç¤ºã•ã‚Œã¾ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/jOoGeKp)


# Search Box Core ã¨ Minimap
## Search Box Coreã¨ã¯

Web/Reactã¨ã¯ç•°ãªã‚Šã€[Search JS Core](https://docs.mapbox.com/mapbox-search-js/api/core/)ã¯UIã‚’æŒãŸãªã„SDKã§ã™ã€‚Search Boxã¨ã—ã¦ã¯[suggest](https://docs.mapbox.com/api/search/search-box/#get-suggested-results)ã‚„[retrieve](https://docs.mapbox.com/api/search/search-box/#retrieve-a-suggested-feature)ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç°¡å˜ã«ã™ã‚‹æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

Search Box APIã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚‚ã”å‚ç…§ãã ã•ã„ã€‚

https://zenn.dev/ottylab/articles/cc176f72c29a16#search-box-api%E3%81%A8%E3%81%AF

## Minimapã¨ã¯

[Minimap](https://docs.mapbox.com/mapbox-search-js/api/web/minimap/)ã¯Address Autofillã‚„Search Boxã«ã‚ˆã‚‹æ¤œç´¢çµæœã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®åœ°å›³æ©Ÿèƒ½ã§ã™ã€‚Minimapã¯Mapbox GL JSã‚’***ä½¿ç”¨ã›ãšã«***åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ç‚¹ãŒé‡è¦ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã€æ¤œç´¢çµæœã‚’å—ã‘å–ã‚‹ã¨[Static Images API](https://docs.mapbox.com/api/maps/static-images/)ã§æ¤œç´¢çµæœå‘¨è¾ºã®åœ°å›³ã‚’å–å¾—ã—ã¾ã™ã€‚ç”»åƒã‚’ä¸€æšè¡¨ç¤ºã™ã‚‹ã ã‘ãªã®ã§ã€è»½é‡ã§ã™ã€‚ãŸã ã—ã€Mapbox GL JSã®ã‚ˆã†ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªåœ°å›³ã¯ä½œæˆã§ãã¾ã›ã‚“ã€‚


# ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°

ãã‚Œã§ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

:::details ã‚³ãƒ¼ãƒ‰
```HTML:index.html
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Search Box/Core + Minimap</title>
<script id="search-js" src="https://api.mapbox.com/search-js/v1.0.0-beta.21/core.js"></script>
<script id="search-js" src="https://api.mapbox.com/search-js/v1.0.0-beta.21/web.js"></script>
</head>
<body>

<form id="form-suggest">
  <input type="text" id="text-suggest"></input>
  <input type="submit" value="Suggest"></input>
</form>

<select></select>

<div style="height: 360px; width: 100%;">
  <mapbox-address-minimap></mapbox-address-minimap>
</div>

<script>
const ACCESS_TOKEN = 'YOUR_MAPBOX_ACCESS_TOKEN';

//
// minimap
//
const minimap = document.querySelector('mapbox-address-minimap');
minimap.accessToken = ACCESS_TOKEN;
minimap.defaultMapStyle = ['mapbox', 'outdoors-v11'];
minimap.theme = {
  variables: { border: '13px solid #bbb', borderRadius: '18px', boxShadow: '0 2px 8px #000' }
}

//
// Seaerch
//
const search = new mapboxsearchcore.SearchBoxCore({accessToken: ACCESS_TOKEN,language: 'ja', country: 'JP'});
const session = new mapboxsearchcore.SearchSession(search);

let suggestions = [];

session.addEventListener('suggest', (res) => {
  console.log('suggest');
  console.log(res.suggestions);

  suggestions = res.suggestions;
  select.replaceChildren();

  const addOption = (value, text) => {
    const option = document.createElement('option');
    option.value = value;
    option.text = text;
    select.appendChild(option);
  };

  addOption('', 'Select');

  suggestions.forEach((suggestion, index)  => {
    addOption(index, suggestion.name);
  });
});

session.addEventListener('retrieve', (res) => {
  console.log('retrieve');
  console.log(res);

  minimap.feature = res.features[0];
});

document.getElementById('form-suggest').addEventListener('submit', (e) => {
  e.preventDefault();
  const text = document.getElementById('text-suggest');
  session.suggest(text.value);
});

const select = document.querySelector('select');
select.addEventListener('change', (e) => {
  if (suggestions.length <= e.target.value) {
      return;
  }

  select.children[0].disabled = true;
  session.retrieve(suggestions[e.target.value]);
});

</script>

</body>
</html>
```
:::

## HTML/CSS
### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿
ä»¥ä¸‹ã§ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚`core.js`ã¯Search Box/Coreã€`web.js`ã¯Minimapã§ä½¿ç”¨ã—ã¾ã™ã€‚
```HTML
<script id="search-js" src="https://api.mapbox.com/search-js/v1.0.0-beta.21/core.js"></script>
<script id="search-js" src="https://api.mapbox.com/search-js/v1.0.0-beta.21/web.js"></script>
```

### æ¤œç´¢ç”¨ã®UI
ä»¥ä¸‹ã§ã¯æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã¨ã€æ¤œç´¢ã‚’é–‹å§‹ã™ã‚‹Submitãƒœã‚¿ãƒ³ã‚’é…ç½®ã—ã¦ã„ã¾ã™ã€‚
```HTML
<form id="form-suggest">
  <input type="text" id="text-suggest"></input>
  <input type="submit" value="Suggest"></input>
</form>
```

### å€™è£œè¡¨ç¤ºã®UI
Submitãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€`suggest`ã‚’ä½¿ç”¨ã—ã¦å€™è£œã‚’è¤‡æ•°å–å¾—ã—ã¾ã™ã€‚ãã‚Œã‚‰ã®å€™è£œã‚’`<select>`ã®ä¸­ã«`<option>`ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚ãã‚Œã‚‰ã®ä¸­ã‹ã‚‰ä¸€ã¤é¸æŠã™ã‚‹ã¨ã€`retrieve`ã‚’ç”¨ã„ã¦è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
```HTML
<select></select>
```

### Minimap
Minimapã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€ã‚’å®šç¾©ã—ã¾ã™ã€‚
```HTML
<div style="height: 360px; width: 100%;">
  <mapbox-address-minimap></mapbox-address-minimap>
</div>
```

## JavaScript
### Minimap
ã¾ãšæœ€åˆã«Minimapã«ã¤ã„ã¦è¨˜è¿°ã—ã¾ã™ã€‚Minimapã¯`MapboxAddressMinimap`ã¨ã„ã†`HTMLElement`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã§å®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€`mapbox-address-minimap`ã¨ã„ã†[Custom Element](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements)ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯HTMLå†…ã§è¨˜è¿°ã—ãŸ`<mapbox-address-minimap>`ã‚¿ã‚°ã«å¯¾ã—ã¦è¨­å®šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```JavaScript
//
// minimap
//
const minimap = document.querySelector('mapbox-address-minimap');
minimap.accessToken = ACCESS_TOKEN;
minimap.defaultMapStyle = ['mapbox', 'outdoors-v11'];
minimap.theme = {
  variables: { border: '13px solid #bbb', borderRadius: '18px', boxShadow: '0 2px 8px #000' }
}
```

å‹•çš„ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãªã„ã®ã§ã‚ã‚Œã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã«`<mapbox-address-minimap>`ã‚¿ã‚°å†…ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨˜è¼‰ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚
```HTML
 <mapbox-address-minimap access-token="YOUR_MAPBOX_ACCESS_TOKEN"></mapbox-address-minimap>
```

ã¾ãŸã€ã‚³ãƒ³ãƒ†ãƒŠã ã‘ã‚’ç”¨æ„ã—ã€ã‚¿ã‚°ã‚’ä½¿ç”¨ã›ãšã«`MapboxAddressMinimap`ã‚’å‹•çš„ã«ä½œæˆã—ã¦ã‚‚OKã§ã™ã€‚
```JavaScript
const minimapContainer = document.getElementById('minimap-container');
const minimap = new MapboxAddressMinimap();
minimapContainer.appendChild(minimap);
minimap.accessToken = ACCESS_TOKEN;
minimap.defaultMapStyle = ['mapbox', 'outdoors-v11'];
minimap.theme = {
  variables: { border: '13px solid #bbb', borderRadius: '18px', boxShadow: '0 2px 8px #000' }
}
```


Minimapã¯`Minimap#feature`ã«å€¤ãŒæ ¼ç´ã•ã‚Œã‚‹ã¾ã§è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã€æ ¼ç´ã•ã‚Œã‚‹å€¤ã¯[GeoJSONã®Point](https://datatracker.ietf.org/doc/html/rfc7946#section-3.1.2)ã§ã™ã€‚

### Search Box/Core
æ¬¡ã«Search Boxã«ã¤ã„ã¦è¨˜è¿°ã—ã¾ã™ã€‚`SearchBoxCore`ã‚¯ãƒ©ã‚¹ãŒ`suggest`ã¨`retrieve`ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ã¾ãŸã€è¤‡æ•°å›ã®`suggest`ã¨`retrieve`ã¯ä¸€ã¤ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ãŒã€ãã‚Œã‚’ç°¡å˜ã«å®Ÿç¾ã™ã‚‹ãŸã‚ã®`SearchSession`ã‚¯ãƒ©ã‚¹ã§`SearchBoxCore`ã‚’ãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚

```JavaScript
//
// Seaerch
//
const search = new mapboxsearchcore.SearchBoxCore({accessToken: ACCESS_TOKEN,language: 'ja', country: 'JP'});
const session = new mapboxsearchcore.SearchSession(search);
```

æœ€åˆã«`suggest`ã®çµæœã‚’ä¿å­˜ã—ã¦ãŠãé…åˆ—ã‚’ä½œæˆã—ã¦ãŠãã¾ã™ã€‚

```JavaScript
let suggestions = [];
```

æ¬¡ã«ã€`suggest`ã‚’æ‰±ã†å‡¦ç†ã§ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã®Submitãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«`SearchSession#suggest`ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```JavaScript
document.getElementById('form-suggest').addEventListener('submit', (e) => {
  e.preventDefault();
  const text = document.getElementById('text-suggest');
  session.suggest(text.value);
});
```

`SearchSession#suggest`ã¯çµæœã‚’å–å¾—å¾Œã€`suggest`ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã¾ã™ã€‚ãã“ã§ã€ãã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã“ã§ã¯çµæœã‚’`suggestions`ã«æ ¼ç´ã—ã¤ã¤ã€`<select>`ã‚¿ã‚°ã®ä¸­ã«å€™è£œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```JavaScript
session.addEventListener('suggest', (res) => {
  console.log('suggest');
  console.log(res.suggestions);

  suggestions = res.suggestions;

  const select = document.querySelector('select');
  select.replaceChildren();

  const addOption = (value, text) => {
    const option = document.createElement('option');
    option.value = value;
    option.text = text;
    select.appendChild(option);
  };

  addOption('', 'Select');

  suggestions.forEach((suggestion, index)  => {
    addOption(index, suggestion.name);
  });
});
```

æœ€å¾Œã«`retrieve`ã‚’æ‰±ã†å‡¦ç†ã§ã™ã€‚`<select>`ã‚¿ã‚°ã®è¦ç´ ãŒä¸€ã¤é¸æŠã•ã‚Œã‚‹ã¨ã€ãã“ã‹ã‚‰`sugessionts`ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æŒ‡å®šã—ã¦`SearchSession#retrieve`ã«å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã¾ã™ã€‚

```JavaScript
const select = document.querySelector('select');
select.addEventListener('change', (e) => {
  if (suggestions.length <= e.target.value) {
      return;
  }

  select.children[0].disabled = true;
  session.retrieve(suggestions[e.target.value]);
});
```

`SearchSession#retrieve`ã¯çµæœã‚’å–å¾—å¾Œã€`retrieve`ã¨ã„ã†ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã¾ã™ã€‚ãã“ã§ã€ãã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã“ã§ã¯çµæœã‚’Minimapã®`feature`ã«ãã®ã¾ã¾ä»£å…¥ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å§‹ã‚ã¦MinimapãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```JavaScript
session.addEventListener('retrieve', (res) => {
  console.log('retrieve');
  console.log(res);

  minimap.feature = res.features[0];
});
```

# Minimapã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
Minimapè‡ªä½“ã¯Static Images APIã§å–å¾—ã—ãŸç”»åƒã§ã™ãŒã€ãƒãƒ¼ã‚«ãƒ¼ã¯`HTMLElement`ã¨ã—ã¦åœ°å›³ã®ä¸Šã«é‡ã­ã¦æç”»ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€ãƒãƒ¼ã‚«ãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚‚å¤‰æ›´ã§ãã¾ã™ã€‚

ã¾ãšã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
```HTML
<style>
  .marker {
    background-image: url('https://docs.mapbox.com/mapbox-gl-js/assets/pin.svg');
    background-size: cover;
    cursor: pointer;
    width: 100px;
    height: 100px;
  }
</style>
```

ãã—ã¦ã€`theme`ã§è¨­å®šã—ã¾ã™ã€‚
```JavaScript
minimap.theme = {
  variables: { border: '13px solid #bbb', borderRadius: '18px', boxShadow: '0 2px 8px #000' },
  icons: {marker: '<div class="marker"></div>'}
}
```

ä»–ã«ã‚‚ã€`satelliteToggle`ã‚’è¨­å®šã™ã‚‹ã¨ã€è¡›æ˜Ÿç”»åƒã¸åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```JavaScript
minimap.satelliteToggle = true;
```

çµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/jOoaogK)


# Reactç‰ˆMinimap
Minimapã¯Reactã®å®Ÿè£…ã‚‚ã‚ã‚Šã¾ã™ã€‚ç°¡å˜ãªä½¿ã„æ–¹ã¯ä»¥ä¸‹ã®ãƒ‡ãƒ¢ã‚’ã”å‚ç…§ãã ã•ã„ã€‚[Safari](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚„[Firefox](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚’ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ã¯ãƒ‡ãƒ¢ãŒå®Ÿè¡Œã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚Chromeã§è¡¨ç¤ºã™ã‚‹ã‹ã€ https://stackblitz.com/edit/vitejs-vite-y4jt2k ã‚’ç›´æ¥ã”å‚ç…§ãã ã•ã„ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-y4jt2k?embed=1&file=src%2Fassets%2Freact.svg&view=preview)

# ã¾ã¨ã‚
Search JS Coreã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ç›´æ¥APIã‚’æ“ä½œã™ã‚‹ã‚ˆã‚Šã‚‚ç°¡å˜ã«çµæœã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã¾ãŸã€Minimapã¯æ¤œç´¢çµæœã‚’è¡¨ç¤ºã™ã‚‹ã®ã«ä¾¿åˆ©ãªè»½é‡ã®åœ°å›³ã§ã‚ã‚‹ã“ã¨ã‚ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
