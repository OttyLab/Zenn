---
title: "Tilesets CLIã§ãƒ©ã‚¹ã‚¿ãƒ¼MTS"
emoji: "ğŸ”¨"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "GIS", "GeoTIFF", "MTS"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

å‰å›ã®è¨˜äº‹ã§ã¯APIã‚’ç›´æ¥å‘¼ã³å‡ºã™å½¢ã§MTSã‚’è©¦ã—ã¾ã—ãŸã€‚ä»Šå›ã¯Tilesets CLIã‚’ç”¨ã„ã¦è©¦ã—ã¦ã¿ã¾ã™ã€‚

https://zenn.dev/ottylab/articles/9fc83e9a211d35/


# Tilesets CLI
[Tilesets CLI](https://github.com/mapbox/tilesets-cli)ã¯MTSã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆä½œæˆç­‰ã‚’è¡Œã†ãŸã‚ã®CLIãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Pythonã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Python 3.6ä»¥ä¸Šã®ç’°å¢ƒã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```shell-session
% pip install mapbox-tilesets
```

ã¾ãŸã€è¿½åŠ æ©Ÿèƒ½ã®`estimate-area`ã‚’ä½¿ç”¨ã™ã‚‹éš›ã¯ã€[GitHubã®README](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#installing-optional-estimate-area-command)ã‚’å‚è€ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

## ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®š
Tilesets CLIãŒä½¿ç”¨ã™ã‚‹ãŸã‚ã€å‰å›ä½œæˆã—ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚

```shell-session
% export MAPBOX_ACCESS_TOKEN=sk....
```

# Vector MTS
## ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
Tilesets CLIã¯GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’line-delimited GeoJSONã«å¤‰æ›ã—ã¦ãã‚Œã¾ã™ã€‚ãã“ã§ã€ä»Šå›ã¯é€šå¸¸ã®GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¾ã™ã€‚

```json:bus.geojson
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "id": 1,
      "properties": {
        "name": "JRæ±äº¬é§…ã€€å…«é‡æ´²å—å£"
      },
      "geometry": {
        "coordinates": [
          139.7681965,
          35.6796462
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "id": 1,
      "properties": {
        "name": "ãƒã‚¹ã‚¿æ–°å®¿"
      },
      "geometry": {
        "coordinates": [
          139.7007717,
          35.6884839
        ],
        "type": "Point"
      }
    },
    {
      "type": "Feature",
      "id": 1,
      "properties": {
        "name": "ã‚µãƒ³ã‚·ãƒ£ã‚¤ãƒ³ã‚·ãƒ†ã‚£ã€€ãƒ—ãƒªãƒ³ã‚¹ãƒ›ãƒ†ãƒ«"
      },
      "geometry": {
        "coordinates": [
          139.719704,
          35.7298991
        ],
        "type": "Point"
      }
    }
  ]
}
```

## ãƒ¬ã‚·ãƒ”ã®æº–å‚™
å‰å›ã¨åŒæ§˜ã®ã‚‚ã®ã‚’æº–å‚™ã—ã¾ã™ã€‚ãŸã ã—ã€APIã‚’ä½¿ç”¨ã™ã‚‹éš›ã®ãƒ¬ã‚·ãƒ”ãƒ•ã‚¡ã‚¤ãƒ«ã¯å³å¯†ã«ã¯ãƒ¬ã‚·ãƒ”+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã§ã—ãŸã€‚
```json:å‰å›ã®bus.geojson
{
  "recipe": {
    //ãƒ¬ã‚·ãƒ”ã®ä¸­èº«
  },
  //ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
}
```

ä»Šå›ã¯ã€Œãƒ¬ã‚·ãƒ”ã®ä¸­èº«ã€ã®éƒ¨åˆ†ã ã‘ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æº–å‚™ã—ã¾ã™ã€‚
```json:bus.geojson
{
  "version": 1,
  "layers": {
    "layer0": {
      "source": "mapbox://tileset-source/yochi/bus-tilesets-cli",
      "minzoom": 0,
      "maxzoom": 18
    }
  }
}
```

## ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ä½œæˆ
[`upload-source`ã‚³ãƒãƒ³ãƒ‰](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#upload-source)ã§ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<username> <source_id> <file>`ã§ã™ã€‚

```shell-session
% tilesets upload-source yochi bus-tilesets-cli bus.geojson
```

## ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ä¸€è¦§
[`list-sources`ã‚³ãƒãƒ³ãƒ‰](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#list-sources)ã§ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚’å–å¾—ã§ãã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<username>`ã§ã™ã€‚

```shell-session
% tilesets list-sources yochi
mapbox://tileset-source/yochi/bus-tilesets-cli
mapbox://tileset-source/yochi/fuji
mapbox://tileset-source/yochi/bus
```

## ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆä½œæˆ
[`create`ã‚³ãƒãƒ³ãƒ‰](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#create)ã§ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<tileset_id> --recipe <file> --name <name>`ã§ã™ã€‚å‰å›ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æŒ‡å®šã—ã¦ã„ãŸ`name`ãŠã‚ˆã³`description`ã‚’ã“ã“ã§æŒ‡å®šã—ã¾ã™ (`description`ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³)ã€‚

```shell-session
% tilesets create yochi.bus-tilesets-cli --recipe recipe.json --name "Bus Tilesets CLI" --description "Bus stops"
{"message": "Successfully created empty tileset yochi.bus-tilesets-cli. Publish your tileset to begin processing your data into tiles."}
```

å‰å›åŒæ§˜ã€Studioä¸Šã§ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![before_publish](/images/articles/f8b475c0543469/before_publish.png)

## ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥
[`publishã‚³ãƒãƒ³ãƒ‰`](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#publish)ã§ä½¿ç”¨å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<tileset_id>`ã§ã™ã€‚

```shell-session
% tilesets publish yochi.bus-tilesets-cli
{"message": "Processing yochi.bus-tilesets-cli", "jobId": "cm09ddr7l003308l3foyba482"}

âœ” Tileset job received. Visit https://studio.mapbox.com/tilesets/yochi.bus-tilesets-cli or run tilesets job yochi.bus-tilesets-cli cm09ddr7l003308l3foyba482 to view the status of your tileset.
```

## é€²æ—ç¢ºèª
[`status`ã‚³ãƒãƒ³ãƒ‰](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#status)ã§é€²æ—ãŒç¢ºèªã§ãã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<tileset_id>`ã§ã™ã€‚å¤‰æ›ä¸­ã®`status`ã¯`processing`ã§ã™ã€‚

```shell-session
% tilesets status yochi.bus-tilesets-cli
{"id": "yochi.bus-tilesets-cli", "latest_job": "cm09ddr7l003308l3foyba482", "status": "processing"}
```

å¤‰æ›ãŒå®Œäº†ã™ã‚‹ã¨`status`ãŒ`success`ã«ãªã‚Šã¾ã™ã€‚

```shell-session
% tilesets status yochi.bus-tilesets-cli
{"id": "yochi.bus-tilesets-cli", "latest_job": "cm09ddr7l003308l3foyba482", "status": "success"}
```

## å®Œæˆ
Studioä¸Šã§ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆãŒç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
![published](/images/articles/f8b475c0543469/published.png)


# Raster MTS
## GeoTIFFã‚’æº–å‚™ã™ã‚‹
å‰å›ä½œæˆã—ãŸGeoTIFFã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## ãƒ¬ã‚·ãƒ”ã®æº–å‚™
Vector MTSã¨åŒæ§˜ã«ã€ãƒ¬ã‚·ãƒ”æœ¬ä½“ã®ã¿ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¾ã™ã€‚

```json:bus.geojson
{
  "type": "raster",
  "version": 1,
  "sources": [
    {
      "uri": "mapbox://tileset-source/yochi/fuji-tilesets-cli"
    }
  ],
  "minzoom": 0,
  "maxzoom": 16,
  "layers": {
    "fuji": {
      "tilesize": 512,
      "buffer": 1
    }
  }
}
```

## ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ä½œæˆ
[`upload-raster-source`ã‚³ãƒãƒ³ãƒ‰](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#upload-raster-source)ã§ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<username> <source_id> <file>`ã§ã™ã€‚

```shell-session
% tilesets upload-raster-source yochi fuji-tilesets-cli fuji.tiff
upload progress  [-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]    0%
{"id": "mapbox://tileset-source/yochi/fuji-tilesets-cli", "files": 1, "source_size": 1533817, "file_size": 1533817}
```

## ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ä¸€è¦§
[`list-sources`ã‚³ãƒãƒ³ãƒ‰](https://github.com/mapbox/tilesets-cli?tab=readme-ov-file#list-sources)ã§ã‚¿ã‚¤ãƒ«ã‚½ãƒ¼ã‚¹ä¸€è¦§ã‚’å–å¾—ã§ãã¾ã™ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯`<username>`ã§ã™ã€‚

```shell-session
% tilesets list-sources yochi
mapbox://tileset-source/yochi/fuji-tilesets-cli
mapbox://tileset-source/yochi/bus-tilesets-cli
mapbox://tileset-source/yochi/fuji
mapbox://tileset-source/yochi/bus
```
## ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆä½œæˆ
ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆã®ä½œæˆæ–¹æ³•ã¯ãƒ™ã‚¯ã‚¿ãƒ¼MTSã¨åŒã˜ã§ã™ã€‚

```shell-session
% tilesets create yochi.fuji-tilesets-cli --recipe recipe_fuji.json --name "Mt.Fuji Tilesets CLI" --description "Mt.Fuji image"
{"message": "Successfully created empty tileset yochi.fuji-tilesets-cli. Publish your tileset to begin processing your data into tiles."}
```

## ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥
ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥æ–¹æ³•ã‚‚ãƒ™ã‚¯ã‚¿ãƒ¼MTSã¨åŒã˜ã§ã™ã€‚

```shell-session
% tilesets publish yochi.fuji-tilesets-cli
{"message": "Processing yochi.fuji-tilesets-cli", "jobId": "cm09drb4l008008mfa74lcew8"}

âœ” Tileset job received. Visit https://studio.mapbox.com/tilesets/yochi.fuji-tilesets-cli or run tilesets job yochi.fuji-tilesets-cli cm09drb4l008008mfa74lcew8 to view the status of your tileset.
```

## å®Œæˆ
Studioä¸Šã§ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆãŒç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
![published_fuji](/images/articles/f8b475c0543469/published_fuji.png)


# ä½¿ã£ã¦ã¿ã‚‹
å‰å›ã¨åŒæ§˜ï¼ˆ`addSource`ã®`url`ã®ã¿å¤‰æ›´ï¼‰ã€ä½œæˆã—ãŸã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ãŸçµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/rNEvgwv)


# ã¾ã¨ã‚
Tilesets CLIã§ã‚ˆã‚Šç°¡å˜ã«MTSãŒåˆ©ç”¨ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
