---
title: "ãƒ¢ãƒã‚¤ãƒ«SDKã§ã‚‚Party Parrot"
emoji: "ğŸ¦œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "Android", "iOS", "Flutter", "GIS"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€Œ[ã‚‚ã†ä¸€ã¤ã®Party Parrot](https://zenn.dev/mapbox_japan/articles/e8702cb8d3ec0e)ã€ã®ç¶šãã§ã™ã€‚[Mapbox Maps SDK for Android](https://docs.mapbox.com/android/maps/guides/)ã€ [Mapbox Maps SDK for iOS](https://docs.mapbox.com/ios/maps/guides/)ãŠã‚ˆã³[Mapbox Maps SDK Flutter Plugin](https://github.com/mapbox/mapbox-maps-flutter)ã§Parrotã‚’Partyã•ã›ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚


# Partyã®é–‹å‚¬æ–¹æ³•

Mapbox GL JSã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã—ã¾ã—ãŸã€‚

0. Parrotã®GIFå‹•ç”»ç”»åƒã‚’ãƒ•ãƒ¬ãƒ¼ãƒ ã«åˆ†è§£
1. Mapã®ãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚’å¾…ã¤
2. Parrotã®å„ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
3. `addImage`ã§ç”»åƒã‚’ç™»éŒ²
4. `addSource`ã§GeoJSONã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²
5. `addLayer`ã§ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆ
6. ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”»åƒã‚’å¤‰æ›´

å®Ÿã¯ã€ãƒ¢ãƒã‚¤ãƒ«SDKã§ã‚‚å…¨ãåŒã˜æ‰‹é †ã§Partyã§ãã¾ã™ã€‚ãŸã ã—ã€ãƒ¢ãƒã‚¤ãƒ«ã¨ã„ã†ã“ã¨ã§ã€ã“ã®è¨˜äº‹ã§ã¯Assetsã‚„ãƒãƒ³ãƒ‰ãƒ«ã«GeoJSONãŠã‚ˆã³ç”»åƒã‚’å…¥ã‚Œã¦èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€ã“ã‚Œã‚‰ã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§å–å¾—ã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã®ã‚‚ã€ã‚‚ã¡ã‚ã‚“OKã§ã™ã€‚

ãã‚Œã§ã¯Androidã€iOSã€Flutterã®é †ã«å®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ä»Šå›ã¯å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å‘ã‘ã«ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãŸã ã—ã€æŒ™å‹•ã‚’ç¤ºã™ãŸã‚ã®ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã§ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ãªã©ã¯è¡Œã£ã¦ã„ã¾ã›ã‚“ã€‚è£½å“ã«ä½¿ç”¨ã™ã‚‹éš›ã«ã¯ã”æ³¨æ„ãã ã•ã„ã€‚

# Android
## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ç”¨ã™ã‚‹éš›ã«ã¯`app/src/main/res/values/strings.xml`ã®`YOUR_MAPBOX_PUBLIC_TOKEN`ã®éƒ¨åˆ†ã«è‡ªåˆ†ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

@[card](https://github.com/OttyLab/Zenn/tree/main/code/articles/c2a98b184dc6a4/android)

è‡ªåˆ†ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹éš›ã«ã¯ä»¥ä¸‹ã®Installationã‚¬ã‚¤ãƒ‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

@[card](https://docs.mapbox.com/android/maps/guides/install/)

## å‡¦ç†å†…å®¹

åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹å ´æ‰€ã«`MapView`ã‚¿ã‚°ã‚’é…ç½®ã—ã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ã¯`activity_main.xml`ã«ä»¥ä¸‹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ä¸­å¿ƒåº§æ¨™ç­‰ã‚‚ã“ã“ã§è¨­å®šã—ã¦ã„ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã‹ã‚‰è¨­å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```xml
<com.mapbox.maps.MapView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    xmlns:mapbox="http://schemas.android.com/apk/res-auto"
    android:id="@+id/mapView"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    mapbox:mapbox_cameraTargetLat="35.6811649"
    mapbox:mapbox_cameraTargetLng="139.763906"
    mapbox:mapbox_cameraZoom="14.0"
    />
```

æ¬¡ã«Kotlinã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚åœ°å›³ã®ãƒ­ãƒ¼ãƒ‰ã«ã¯`loadStyle`ç³»ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã“ã§ã¯`loadStyleUri`ã‚’ä½¿ç”¨ã—ã€ç¬¬ä¸€å¼•æ•°ã«ã‚¹ã‚¿ã‚¤ãƒ«ã®URLã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ç¬¬äºŒå¼•æ•°ãŒåœ°å›³ã®ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã•ã‚ŒãŸã¨ãã«å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã—ã¦ã„ã¾ã™ã€‚

```Kotlin
mapView?.getMapboxMap()?.loadStyleUri(Style.LIGHT){
  ...
}
```

ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ä¸­ã§ã¯ä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™

1. ç”»åƒã®ç™»éŒ²
2. GeoJSONã‚½ãƒ¼ã‚¹ã®ç™»éŒ²
3. ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
4. ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”»åƒã‚’å¤‰æ›´

ã¾ãšã¯ç”»åƒã®ç™»éŒ²ã§ã™ã€‚`drawable`ã«`frame0.png`ã€œ`frame9.png`ã®ç”»åƒãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã€èª­ã¿è¾¼ã‚“ã§`Style#addImage`ã§ç™»éŒ²ã—ã¾ã™ã€‚

```Kotlin
    it.addImage("parrot0", BitmapFactory.decodeResource(resources, R.drawable.frame0))
    it.addImage("parrot1", BitmapFactory.decodeResource(resources, R.drawable.frame1))
    it.addImage("parrot2", BitmapFactory.decodeResource(resources, R.drawable.frame2))
    it.addImage("parrot3", BitmapFactory.decodeResource(resources, R.drawable.frame3))
    it.addImage("parrot4", BitmapFactory.decodeResource(resources, R.drawable.frame4))
    it.addImage("parrot5", BitmapFactory.decodeResource(resources, R.drawable.frame5))
    it.addImage("parrot6", BitmapFactory.decodeResource(resources, R.drawable.frame6))
    it.addImage("parrot7", BitmapFactory.decodeResource(resources, R.drawable.frame7))
    it.addImage("parrot8", BitmapFactory.decodeResource(resources, R.drawable.frame8))
    it.addImage("parrot9", BitmapFactory.decodeResource(resources, R.drawable.frame9))
```

æ¬¡ã«GeoJSONã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚`party.json`ãŒ`assets`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã£ã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«`GeoJsonSource`ã¨ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã€‚ã•ã‚‰ã«`addSource`ã§ã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

```Kotlin
    val source = GeoJsonSource.Builder("party-source").url("asset://party.json").build()
    it.addSource(source)
```

GeoJSONã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚åˆæœŸç”»åƒã¯`parrot0`(`frame0.png`)ã§ã€ã‚µã‚¤ã‚ºã‚‚32x32ã«ç¸®å°ã—ã¾ã™ã€‚`addLayer`ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```Kotlin
    val layer = SymbolLayer("party-layer", "party-source")
    layer.iconImage("parrot0")
    layer.iconSize(0.25)
    it.addLayer(layer)
```

æœ€å¾Œã«ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«`iconImage`ã®å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã“ã§ã€Maps SDKã«å¯¾ã™ã‚‹æ“ä½œã¯å¿…ãšãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯SDKãŒã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã§ã¯ãªã„ã“ã¨ã«èµ·å› ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰ã®æ“ä½œï¼ˆä¾‹ãˆã°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤ï¼‰ã‚’è¡Œã£ãŸå ´åˆã€ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```Kotlin
    var counter = 0;
    val handler = Handler(Looper.getMainLooper())
    handler.postDelayed(object: Runnable{
        override fun run() {
            handler.postDelayed(this, 50)
            layer.iconImage("parrot${(++counter) % 10}")
        }
    }, 100)
```

çµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

https://youtube.com/shorts/DklRkyxa6C4

## ãŠã¾ã‘ - DSL

Androidã¯[DSL](https://docs.mapbox.com/android/maps/guides/migrate-to-v10/#style-dsl)ã¨å‘¼ã°ã‚Œã‚‹è¨˜æ³•ã§ã‚‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆãŒå¯èƒ½ã§ã™ã€‚å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```Kotlin
mapView?.getMapboxMap()?.loadStyle(
    style(styleUri = Style.LIGHT) {
        +image("parrot0") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame0))
        }
        +image("parrot1") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame1))
        }
        +image("parrot2") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame2))
        }
        +image("frame3") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame3))
        }
        +image("parrot4") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame4))
        }
        +image("parrot5") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame5))
        }
        +image("parrot6") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame6))
        }
        +image("parrot7") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame7))
        }
        +image("parrot8") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame8))
        }
        +image("parrot9") {
            bitmap(BitmapFactory.decodeResource(resources, R.drawable.frame9))
        }

        +geoJsonSource("party-source") {
            url("asset://party.json")
        }

        +symbolLayer("party-layer", "party-source") {
            iconImage("frame0")
            iconSize(0.25)
        }
    }
) {
    var counter = 0;
    val handler = Handler(Looper.getMainLooper())
    handler.postDelayed(object: Runnable{
        override fun run() {
            handler.postDelayed(this, 50)
            val layer = it.getLayer("party-layer") as SymbolLayer
            layer.iconImage("parrot${(++counter) % 10}")
        }
    }, 100)
}
```


# iOS
## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ç”¨ã™ã‚‹éš›ã«ã¯`Party Parrot/ViewController.swift`ã®`YOUR_MAPBOX_PUBLIC_TOKEN`ã®éƒ¨åˆ†ã«è‡ªåˆ†ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

@[card](https://github.com/OttyLab/Zenn/tree/main/code/articles/c2a98b184dc6a4/ios)

è‡ªåˆ†ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹éš›ã«ã¯ä»¥ä¸‹ã®Installationã‚¬ã‚¤ãƒ‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

@[card](https://docs.mapbox.com/ios/maps/guides/install/)

## å‡¦ç†å†…å®¹

`MapView`ã¯ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ä½œæˆã—ã€`ViewController`ã®å­ã¨ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚

```Swift
let resourceOptions = ResourceOptions(accessToken: YOUR_MAPBOX_PUBLIC_TOKEN)
let centerCoordinate = CLLocationCoordinate2D(latitude: 35.6811649, longitude: 139.763906)
let mapInitOptions = MapInitOptions(
    resourceOptions: resourceOptions,
    cameraOptions: CameraOptions(center: centerCoordinate, zoom: 14.0),
    styleURI: .light)
mapView = MapView(frame: view.bounds, mapInitOptions: mapInitOptions)
mapView.autoresizingMask = [.flexibleWidth, .flexibleHeight]

self.view.addSubview(mapView)
```

åœ°å›³ã®ãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ã«è¡Œã†å‡¦ç†ã¯`onNext`ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦è¨˜è¿°ã—ã¾ã™ã€‚`onNext`ç¬¬ä¸€å¼•æ•°ã§æŒ‡å®šã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã¨ãã«ä¸€å›ã ã‘å®Ÿè¡Œã—ã¾ã™ã€‚ã¡ãªã¿ã«ã€`onNext`ã®ä»–ã«`onEvery`ãŒã‚ã‚Šã€ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã™ã‚‹ã¨æ¯å›å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```Swift
mapView.mapboxMap.onNext(event: .mapLoaded) { _ in
  ...
}
```

ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ä¸­ã§ã¯ä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™

1. ç”»åƒã®ç™»éŒ²
2. GeoJSONã‚½ãƒ¼ã‚¹ã®ç™»éŒ²
3. ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
4. ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”»åƒã‚’å¤‰æ›´

ã¾ãšã¯ç”»åƒã®ç™»éŒ²ã§ã™ã€‚`Assets.xcassets`ã«`frame0`ã€œ`frame9`ã¨ã—ã¦ã®ç”»åƒãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€èª­ã¿è¾¼ã‚“ã§`addImage`ã§ç™»éŒ²ã—ã¾ã™ã€‚

```Swift
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame0")!, id: "parrot0")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame1")!, id: "parrot1")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame2")!, id: "parrot2")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame3")!, id: "parrot3")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame4")!, id: "parrot4")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame5")!, id: "parrot5")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame6")!, id: "parrot6")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame7")!, id: "parrot7")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame8")!, id: "parrot8")
try! self.mapView.mapboxMap.style.addImage(UIImage(named: "frame9")!, id: "parrot9")
```

æ¬¡ã«GeoJSONã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚`party.json`ãŒ`assets`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã£ã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«`GeoJsonSource`ã¨ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã€‚ã•ã‚‰ã«`addSource`ã§ã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

```Swift
guard let featureCollection = try? self.decodeGeoJSON(from: "party") else { return }
var source = GeoJSONSource()
source.data = .featureCollection(featureCollection)
try! self.mapView.mapboxMap.style.addSource(source, id: "party-source")
```

GeoJSONã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚åˆæœŸç”»åƒã¯`parrot0`(`frame0.png`)ã§ã€ã‚µã‚¤ã‚ºã‚‚32x32ã«ç¸®å°ã—ã¾ã™ã€‚`addLayer`ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```Swift
var layer = SymbolLayer(id: "party-layer")
layer.source = "party-source"
layer.iconImage = .constant(.name("parrot0"))
layer.iconSize = .constant(0.25)
try! self.mapView.mapboxMap.style.addLayer(layer)
```

æœ€å¾Œã«ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«`iconImage`ã®å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚ã“ã“ã§ã€Maps SDKã«å¯¾ã™ã‚‹æ“ä½œã¯å¿…ãšãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã¯SDKãŒã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã§ã¯ãªã„ã“ã¨ã«èµ·å› ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰ã®æ“ä½œï¼ˆä¾‹ãˆã°ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤ï¼‰ã‚’è¡Œã£ãŸå ´åˆã€ãƒ‡ãƒ¼ã‚¿ç«¶åˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```Swift
var counter = 0;
Timer.scheduledTimer(withTimeInterval: 0.05, repeats: true, block: { _ in
    counter += 1
    try! self.mapView.mapboxMap.style.updateLayer(withId: "party-layer", type: SymbolLayer.self) { layer in
        layer.iconImage = .constant(.name("parrot\(counter % 10)"))
    }
})
```

çµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

https://www.youtube.com/shorts/VvDBq4lThCo

## ãŠã¾ã‘ - ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

GeoJSONã‚’ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€éš›ã«ä»¥ä¸‹ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯[SDKã®ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰](https://github.com/mapbox/mapbox-maps-ios/blob/v10.13.1/Apps/Examples/Examples/All%20Examples/Annotations/MultipleGeometriesExample.swift#L34-L52)ã‚’æ‹å€Ÿã—ã¾ã—ãŸã€‚

```Swift
internal func decodeGeoJSON(from fileName: String) throws -> FeatureCollection? {
    guard let path = Bundle.main.path(forResource: fileName, ofType: "json") else {
        preconditionFailure("File '\(fileName)' not found.")
    }

    let filePath = URL(fileURLWithPath: path)

    var featureCollection: FeatureCollection?

    do {
        let data = try Data(contentsOf: filePath)
        featureCollection = try JSONDecoder().decode(FeatureCollection.self, from: data)
    } catch {
        print("Error parsing data: \(error)")
    }

    return featureCollection
}
```


# Flutter
## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä½¿ç”¨ã™ã‚‹éš›ã«ã¯`lib/main.dart`ã®`YOUR_MAPBOX_PUBLIC_TOKEN`ã®éƒ¨åˆ†ã«è‡ªåˆ†ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

@[card](https://github.com/OttyLab/Zenn/tree/main/code/articles/c2a98b184dc6a4/flutter)

è‡ªåˆ†ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹éš›ã«ã¯ä»¥ä¸‹ã®Installationã‚¬ã‚¤ãƒ‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

@[card](https://pub.dev/packages/mapbox_maps_flutter#installation)

## å‡¦ç†å†…å®¹

ä»¥ä¸‹ã‚’å‚è€ƒã«`MapWidget`ã‚’ä½œæˆã—ã¾ã™ã€‚

@[card](https://zenn.dev/mapbox_japan/articles/d9ba57ca498170)


`onMapCreated`ã«åœ°å›³ãŒãƒ­ãƒ¼ãƒ‰å®Œäº†ã—ãŸéš›ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã“ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ¥ã®é–¢æ•°ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```Dart
_onMapCreated(MapboxMap mapboxMap) async {
  ...
}
```

ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ä¸­ã§ã¯ä»¥ä¸‹ã®å‡¦ç†ã‚’è¡Œã„ã¾ã™

1. ç”»åƒã®ç™»éŒ²
2. GeoJSONã‚½ãƒ¼ã‚¹ã®ç™»éŒ²
3. ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
4. ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”»åƒã‚’å¤‰æ›´

ã¾ãšã¯ç”»åƒã®ç™»éŒ²ã§ã™ã€‚`assets`ã«`frame0.png`ã€œ`frame9.png`ã®ç”»åƒãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã€èª­ã¿è¾¼ã‚“ã§`addImage`ã§ç™»éŒ²ã—ã¾ã™ã€‚

```Dart
await mapboxMap.style.addStyleImage("parrot0", 1.0, await _getImage("assets/frame0.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot1", 1.0, await _getImage("assets/frame1.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot2", 1.0, await _getImage("assets/frame2.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot3", 1.0, await _getImage("assets/frame3.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot4", 1.0, await _getImage("assets/frame4.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot5", 1.0, await _getImage("assets/frame5.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot6", 1.0, await _getImage("assets/frame6.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot7", 1.0, await _getImage("assets/frame7.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot8", 1.0, await _getImage("assets/frame8.png"), false, [], [], null);
await mapboxMap.style.addStyleImage("parrot9", 1.0, await _getImage("assets/frame9.png"), false, [], [], null);
```

æ¬¡ã«GeoJSONã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚`party.json`ãŒ`assets`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã£ã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«`GeoJsonSource`ã¨ã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã€‚ã•ã‚‰ã«`addSource`ã§ã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

```Dart
var geojson = await rootBundle.loadString('assets/party.json');
var source = GeoJsonSource(id: "party-source", data: geojson);
await mapboxMap.style.addSource(source);
```

GeoJSONã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚åˆæœŸç”»åƒã¯`parrot0`(`frame0.png`)ã§ã€ã‚µã‚¤ã‚ºã‚‚32x32ã«ç¸®å°ã—ã¾ã™ã€‚`addLayer`ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```Dart
var layer = SymbolLayer(
  id: "party-layer",
  sourceId: "party-source",
  iconImage: "parrot0",
  iconSize: 0.25,
);
await mapboxMap.style.addLayer(layer);
```

æœ€å¾Œã«ã‚¿ã‚¤ãƒãƒ¼ã§50msæ¯ã«`iconImage`ã®å€¤ã‚’æ›´æ–°ã—ã¾ã™ã€‚

```Dart
var counter = 0;
Timer.periodic(const Duration(milliseconds: 50), (timer) async {
  layer.iconImage = "parrot${(++counter) % 10}";
  await mapboxMap.style.updateLayer(layer);
});
```

çµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

https://youtube.com/shorts/sdoaAT2orNQ

## ãŠã¾ã‘ - ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

ç”»åƒã‚’Assetã‹ã‚‰èª­ã¿è¾¼ã‚€éš›ã«ä»¥ä¸‹ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯[SDKã®ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ¼ãƒ‰](https://github.com/mapbox/mapbox-maps-flutter/blob/0.4.3/example/lib/style.dart#L79-L83)ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

```Dart
Future<MbxImage> _getImage(String path) async {
  final ByteData bytes = await rootBundle.load(path);
  final Uint8List image = bytes.buffer.asUint8List();
  return new MbxImage(width: 128, height: 128, data: image);
}
```

# ã‚‚ã£ã¨Party

å„ã‚µãƒ³ãƒ—ãƒ«ã§`party.json`ã‚’`party1000.json`ã«å¤‰æ›´ã™ã‚‹ã¨ãŸãã•ã‚“Partyã§ãã¾ã™ï¼

https://youtube.com/shorts/758RI9-ArNo

https://youtube.com/shorts/A_jsIPf-oG4

https://youtube.com/shorts/Hx1l_LH62d0


# ã¾ã¨ã‚

ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¯ã«å¤šå°‘ã®é•ã„ã¯ã‚ã‚Œã©ã€åŸºæœ¬çš„ã«åŒã˜å‡¦ç†æ–¹æ³•ã§Party ParrotãŒå®Ÿè£…ã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚Party Parrotã«é™ã‚‰ãšã€ã‚½ãƒ¼ã‚¹/ãƒ¬ã‚¤ãƒ¤ãƒ¼/ã‚½ãƒ¼ã‚¹ã«é–¢é€£ã™ã‚‹æ“ä½œã¯ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–¢ä¿‚ãªãåŒã˜æ§˜ãªæ–¹æ³•ã§æ“ä½œã§ãã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚