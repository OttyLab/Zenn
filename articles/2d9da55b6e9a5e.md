---
title: "Ethernautå®Œèµ°ã®æ„Ÿæƒ³"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Ethereum", "Ethernaut", "Solidity", "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£", "CTF"]
published: true
---

# ã¯ã˜ã‚ã«

[Ethernaut](https://ethernaut.openzeppelin.com/)ã¯Solidityã§è¨˜è¿°ã•ã‚ŒãŸè„†å¼±æ€§ã®ã‚ã‚‹ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¸ã®æ”»æ’ƒã‚’æˆåŠŸã•ã›ã‚‹ã“ã¨ã§ã‚¯ãƒªã‚¢ã™ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚2023å¹´5æœˆ8æ—¥ç¾åœ¨ã§29å€‹ã®ãƒ¬ãƒ™ãƒ«ãŒæ¥½ã—ã‚ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹è‡ªä½“ã¯2018å¹´é ƒã‹ã‚‰ã‚ã‚‹ã‚ˆã†ã§ã™ãŒã€ä»Šã§ã‚‚é »ç¹ã«æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãã‚“ãªè€èˆ—ã‚µãƒ¼ãƒ“ã‚¹ã«ä»Šæ›´ãªãŒã‚‰æŒ‘æˆ¦ã—ãŸã®ã§å„ãƒ¬ãƒ™ãƒ«ã®æ„Ÿæƒ³ã‚’ã¤ã‚‰ã¤ã‚‰ã¨æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚è©³ç´°ãªè§£ç­”ä¾‹ãƒ»è§£èª¬ã¯æ¤œç´¢ã™ã‚‹ã¨ãŸãã•ã‚“å‡ºã¦ãã‚‹ã®ã§ãã¡ã‚‰ã‚’ã”å‚ç…§ãã ã•ã„m(_ _)mã€‚ã¾ãŸã€ãƒã‚¿ãƒãƒ¬ãŒå«ã¾ã‚Œã‚‹ã®ã§ã”æ³¨æ„ãã ã•ã„ã€‚


# 0. Hello Ethernaut

ä½¿ã„æ–¹ã®èª¬æ˜ã ã‘ã®ãƒšãƒ¼ã‚¸ã ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€æœ€å¾Œã«ã‚‚ã†ä¸€å›ã‚ˆãè¦‹ã¦ã¿ã‚‹ã¨ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¨ã—ã¦ã‚¯ãƒªã‚¢ã™ã‚‹èª²é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚Get new instanceãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚èª¬æ˜ã«ã‚ã‚‹é€šã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§JavaScriptã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§å•é¡ŒãŒè§£ã‘ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ãŒã‚ã‚‹ã®ã§ã€ãã®é€šã‚Šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« `await contract.info()`ã¨å…¥åŠ›ã—ã‚¨ãƒ³ã‚¿ãƒ¼ã—ã¾ã™ã€‚

> Look into the level's info method contract.info() or await contract.info() if you're using Chrome v62.

ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```
'You will find what you need in info1().'
```

ã“ã®ãƒ¬ãƒ™ãƒ«ã¯ã“ã‚“ãªæ„Ÿã˜ã§ä¸€ã¤ã®é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¬¡ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ãŒæŒ‡ç¤ºã•ã‚Œã¾ã™ã€‚è§£ãçµ‚ã‚ã£ãŸã‚‰Submitãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚æ­£è§£ã ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãã®æ—¨ãƒ¡ãƒƒã‚»ãƒ¼ãŒã˜è¡¨ç¤ºã•ã‚Œã€Go to the next levelãƒœã‚¿ãƒ³ã«å¤‰åŒ–ã—ã¾ã™ã€‚ã¾ãŸã€Webãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚‚ãã®ãƒ¬ãƒ™ãƒ«ã§å¤§äº‹ã ã£ãŸãƒã‚¤ãƒ³ãƒˆã«é–¢ã™ã‚‹è§£èª¬ã«å¤‰ã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ¬ãƒ™ãƒ«ã§ã¯å†…éƒ¨çš„ã«ä½¿ç”¨ã•ã‚Œã¦ã„ãŸã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚


# 1. Fallback

`owner`ã‚’å¥ªå–ã—ã‚ã¨ã„ã†ã“ã¨ãªã®ã§ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’è¦‹ã¦ã¿ã‚‹ã¨`receive()`ã®ä¸­ã§`owner`ãŒä¸Šæ›¸ãã§ãã‚‹ã®ã§ã“ã®é–¢æ•°ã‚’åˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚


# 2. Fallout

ãƒ¬ãƒ™ãƒ«ã®ç”»åƒãŒå¤§ãƒ’ãƒ³ãƒˆã§ã™ã­ã€‚ãã†ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å(`Fal1out`)ãŒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆå(`Fallout`)ã¨ä¸€è‡´ã—ã¦ã„ãªã„ã§ã™ã€‚ãªã®ã§ã€ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã‚‚æ™®é€šã®é–¢æ•°ã¨ã—ã¦å®Ÿè¡Œã§ãã‚‹ã®ã§`owner`ã‚’å¥ªå–ã§ãã¾ã™ã­ã€‚ã“ã‚Œã¯[SWC-118](https://swcregistry.io/docs/SWC-118)ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹è„†å¼±æ€§ã§ã™ã€‚ã“ã†ã„ã†ãƒŸã‚¹ãŒç™ºç”Ÿã™ã‚‹ã®ã§ã€ä»Šã‹ã‚‰ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½œã‚‹ã®ã§ã‚ã‚Œã°`constructor`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã¤ã‹ã£ã¦ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’è¨˜è¿°ã™ã‚‹ã¹ãã§ã™ã€‚


# 3. Coin Flip

ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ç”Ÿæˆã•ã‚Œã‚‹`side`ã‚’äºˆæ¸¬ã™ã‚‹èª²é¡Œã§ã™ã€‚æ­£è§£ãªã‚‰`consecutiveWins`ãŒã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚Œã¾ã™ãŒã€é–“é•ã†ã¨ã‚¼ãƒ­ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã®ã§10é€£ç¶šæ­£è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```Solidity
    uint256 coinFlip = blockValue / FACTOR;
    bool side = coinFlip == 1 ? true : false;
```

`blockValue`ã¯ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒƒã‚·ãƒ¥ã€`FACTOR`ã¯2ã®255ä¹—ãªã®ã§ç¢ºç‡ã¯1/2ã§ã™ã€‚10é€£ç¶šæ­£è§£ã™ã‚‹ç¢ºç‡ã¯1/1024ã€‚ã“ã‚Œã¯ç¢ºå®Ÿã«é‹ã§ã¯ãªãå®ŸåŠ›ã§è§£ãå¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

ãƒã‚¤ãƒ³ãƒˆã¯ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒƒã‚·ãƒ¥ãŒäºˆæ¸¬ã§ãã‚‹ã‹ã©ã†ã‹ã§ã™ã€‚å®Ÿã¯ã“ã‚Œã¯[SWC-120](https://swcregistry.io/docs/SWC-120)ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹è„†å¼±æ€§ã§ã€ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒƒã‚·ãƒ¥ã‚’ä¹±æ•°ã¨ã—ã¦ä½¿ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚ã¨ã„ã†ã®ã‚‚ã€ãƒã‚¤ãƒŠãƒ¼ã¯ã“ã®å€¤ã‚’èª¿æ•´ã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚

ãŸã ã€ã“ã®èª²é¡Œã‚’è§£ãç§ã¯ãƒã‚¤ãƒŠãƒ¼ã§ã¯ãªã„ã®ã§ã©ã†ã—ã‚ˆã†ã¨æ€ã£ã¦ã“ã£ãã‚Šè§£ç­”ä¾‹ã‚’è¦‹ã¦ç´å¾—ã—ã¾ã—ãŸã€‚ãã†ã€2. ã¾ã§ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§OKã§ã—ãŸãŒã€ã“ã®ãƒ¬ãƒ™ãƒ«ã‹ã‚‰ã¯æ”»æ’ƒç”¨ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ã™ã€‚

æ”»æ’ƒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰ã“ã®ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã™ã¨å¿…ç„¶çš„ã«ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒƒã‚·ãƒ¥ã¯åŒã˜ã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€æ”»æ’ƒã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å†…éƒ¨ã§`side`ãŒè¨ˆç®—ã§ãã‚‹ã®ã§ã€ãã‚Œã‚’ãã®ã¾ã¾`_guess`ã¨ã—ã¦æ¸¡ã—ã¦ã‚ã’ã‚Œã°å®Œäº†ã§ã™ã­ã€‚


# 4. Telephone

ã¾ãŸ`owner`ã‚’å¥ªå–ã™ã‚‹èª²é¡Œã§ã™ã€‚`chageOwner`ã‚’å®Ÿè¡Œã™ã‚Œã°ã„ã„ã§ã™ãŒ`tx.origin != msg.sender`ã¨ã„ã†æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚EOAã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã¨`tx.origin`ã¨`msg.sender`ãŒä¸€è‡´ã—ã¦ã—ã¾ã„ã¾ã™ã€‚ã—ã‹ã—ã€ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ä¸­ã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã¨`tx.origin`ã¯EOAã€`msg.sender`ã¯ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãªã‚‹ã®ã§ã‚¯ãƒªã‚¢ã§ãã¾ã™ã­ã€‚


# 5. Token

[SWC-101](https://swcregistry.io/docs/SWC-101)ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹è„†å¼±æ€§ã‚’çªãå•é¡Œã§ã™ã€‚ã„ã‚ã‚†ã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å•é¡Œã§ã™ã€‚`pragma solidity ^0.6.0;`ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãŒç™ºç”Ÿã—å¾—ã¾ã™ã­ã€‚

ã¨ã„ã†ã“ã¨ã§`_value`ã«`21`ã‚’æ¸¡ã—ã¦ã‚„ã‚‹ã¨`require(balances[msg.sender] - _value >= 0);`ã‚’æº€ãŸã™ã“ã¨ãŒã§ãã¾ã™ã€‚

Solidityã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç‰¹æœ‰ã®ãƒã‚°ãŒã‚ã‚‹ã®ã§ã€ã¾ãšã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ã®ãŒã‚ˆã•ãã†ã§ã™ã€‚


# é–¢é€£è¨˜äº‹

@[card](https://zenn.dev/ottylab/articles/12f73d8f9817e6/)
@[card](https://zenn.dev/ottylab/articles/fb2f9c8c797616/)
@[card](https://zenn.dev/ottylab/articles/93ea8f5a8a3888/)
