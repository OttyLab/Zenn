---
title: "Mapbox Newsletter WEEKLY TIPSã®è§£èª¬ -ã€Œå»ºç‰©ã‚’3Dã§è¡¨ç¤ºã€"
emoji: "ğŸ¢"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥é…ä¿¡ã•ã‚ŒãŸMapbox Newsletterã®WEEKLY TIPSã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€Œå»ºç‰©ã‚’3Dã§è¡¨ç¤ºã€ã«ã¤ã„ã¦ã®è§£èª¬ã§ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯[`fill-extrusion`ãƒ¬ã‚¤ãƒ¤ãƒ¼](https://docs.mapbox.com/mapbox-gl-js/style-spec/layers/#fill-extrusion)ã‚’ç”¨ã„ãŸå»ºç‰©ã®3Dè¡¨ç¾æ–¹æ³•ã‚’ä¾‹ç¤ºã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€Newsletterã®è³¼èª­ã¯[ã“ã¡ã‚‰](https://www.mapbox.jp/blog?#:~:text=%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%AC%E3%82%BF%E3%83%BC%E3%82%92%E8%B3%BC%E8%AA%AD)ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã€‚


# ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

ã¾ãšExamplesã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã«è¡Œãã¾ã—ã‚‡ã†ã€‚

æ—¥æœ¬èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/jp/mapbox-gl-js/example/3d-buildings/)

è‹±èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/mapbox-gl-js/example/3d-buildings/)

åŸºæœ¬çš„ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€è‹±èªç‰ˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒMapbox Light v11ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã¡ã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Mapbox Light v10ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒWebãƒ¡ãƒ«ã‚«ãƒˆãƒ«ã§ã‚ã‚‹ã®ã«å¯¾ã—ã€Mapbox Light v11ã§ã¯Globeï¼ˆ3Dè¡¨ç¤ºã•ã‚ŒãŸåœ°çƒï¼‰ãªã®ã§ã€å°è±¡ãŒã‹ãªã‚Šç•°ãªã‚Šã¾ã™ã€‚

## HTML/CSS

ã¾ãšHTMLã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã¯åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

```HTML
<div id="map"></div>
```

## Mapã®ä½œæˆ

æ¬¡ã«JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã„ã¤ã‚‚é€šã‚Šã€Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚`container`ã§åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®idã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
const map = new mapboxgl.Map({
  // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
  style: 'mapbox://styles/mapbox/light-v11',
  center: [-74.0066, 40.7135],
  zoom: 15.5,
  pitch: 45,
  bearing: -17.6,
  container: 'map',
  antialias: true
});
```

## fill-extrusionãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ 

ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ ã¯`load`ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ä¸­ã§è¡Œã„ã¾ã™ã€‚

```JavaScript
map.on('style.load', () => {/*ã“ã“*/});
```

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯`load`ã§ã¯ãªã`style.load`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚`load`ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚ã¨ã€æ¬¡ã®æç”»ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ç™ºç«ã™ã‚‹ã®ã«å¯¾ã—ã€`style.load`ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸç›´å¾Œã«ç™ºç«ã™ã‚‹ã¨ã„ã†é•ã„ãŒã‚ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€`load`ã‚’ä½¿ç”¨ã™ã‚‹ã¨åœ°å›³ã‚’è¡¨ç¤ºã—ãŸã‚ã¨ä¸€ç¬ã®é–“ãŒç©ºã„ã¦`addLayer`ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¿½åŠ ã•ã‚Œã‚‹ç¬é–“ãŒè¦‹ãˆã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã«å¯¾ã—`style.load`ã¯æœ€åˆã‹ã‚‰`addLayer`ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

### ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ å ´æ‰€ã®æ¢ç´¢

ã¾ãšæœ€åˆã«ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ å ´æ‰€ã‚’æ¢ç´¢ã—ã¦ã„ã¾ã™ã€‚`map.getStyle().layers`ã§Light v11ã®ã™ã¹ã¦ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚[ã“ã®ã¨ãå–å¾—ã•ã‚Œã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é…åˆ—](https://github.com/mapbox/mapbox-gl-js/blob/v2.15.0/src/style/style.js#L1251)ã¯ã‚¹ã‚¿ã‚¤ãƒ«ã®ä¸€ç•ªä¸‹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é †ç•ªã«å…¥ã£ã¦ã„ã¾ã™ã€‚

ãã—ã¦`layers.find`ã§ã‚·ãƒ³ãƒœãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã¤`text-field`ã‚’æŒã£ã¦ã„ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚è¦ã™ã‚‹ã«ã€ä½•ã‹ã—ã‚‰ãƒ†ã‚­ã‚¹ãƒˆãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸­ã§ä¸€ç•ªæœ€åˆã«è¦‹ã¤ã‹ã‚‹ã‚‚ã®ï¼ˆä¸€ç•ªä¸‹ã«ã‚ã‚‹ã‚‚ã®ï¼‰ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯`road-label-simple`ã¨ã„ã†ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚

```JavaScript
// Insert the layer beneath any symbol layer.
const layers = map.getStyle().layers;
const labelLayerId = layers.find(
  (layer) => layer.type === 'symbol' && layer.layout['text-field']
).id;
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆå‰åŠæˆ¦

ãã—ã¦`addLayer`ã§`fill-extrusion`ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚å»ºç‰©ã®é«˜ã•æƒ…å ±ã¯[Mapbox Streets v8ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆã®`building`ãƒ¬ã‚¤ãƒ¤ãƒ¼](https://docs.mapbox.com/data/tilesets/reference/mapbox-streets-v8/#building)ã«`height`ã‚„`min_heigh`ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦æ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«`extrude`ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯é«˜ã•æƒ…å ±ãŒæœ‰åŠ¹ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«Studioã§Buidlingãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç¢ºèªã™ã‚‹ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚

![studio](/images/articles/bed09320ed08fd/studio.png)

ã¾ãŸã€ä»¥ä¸‹ã®ã‚ˆã†ã«Light v11ã§ã¯Streets v8ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆã‚’`composite`ã¨ã„ã†ã‚½ãƒ¼ã‚¹åã§ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

![light-v11](/images/articles/bed09320ed08fd/light-v11.png)

ã¨ã„ã†ã“ã¨ã§ã€`addLayer`ã®å‰åŠéƒ¨åˆ†ã¯ã€Œ`composite`ã‚½ãƒ¼ã‚¹ã®`building`ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã—ã¦`fill-extrusion`ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã€‚ãŸã ã—ã€`extrude`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ`true`ã®ã‚‚ã®ã«é™ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’æŒ‡ç¤ºã—ã¦ã„ã¾ã™ã€‚

```JavaScript
map.addLayer(
  {
    'id': 'add-3d-buildings',
    'source': 'composite',
    'source-layer': 'building',
    'filter': ['==', 'extrude', 'true'],
    'type': 'fill-extrusion',
    'minzoom': 15,
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆå¾ŒåŠæˆ¦

ç¶šã„ã¦å¾ŒåŠéƒ¨åˆ†ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚[`fill-extrusion-color`](https://docs.mapbox.com/mapbox-gl-js/style-spec/layers/#paint-fill-extrusion-fill-extrusion-color)ã¯å»ºç‰©ã®è‰²ã€[`fill-extrusion-opacity`](https://docs.mapbox.com/mapbox-gl-js/style-spec/layers/#paint-fill-extrusion-fill-extrusion-opacity)ã¯å»ºç‰©ã®ä¸é€æ˜åº¦ã‚’æŒ‡å®šã—ã¾ã™ã€‚[`fill-extrusion-height`](https://docs.mapbox.com/mapbox-gl-js/style-spec/layers/#paint-fill-extrusion-fill-extrusion-height)ã¯å»ºç‰©ã®é«˜ã•ã€[`fill-extrusion-base`](https://docs.mapbox.com/mapbox-gl-js/style-spec/layers/#paint-fill-extrusion-fill-extrusion-base)ã¯å»ºç‰©ã®æç”»ã‚’å§‹ã‚ã‚‹é«˜ã•ã‚’æŒ‡å®šã—ã¾ã™ã€‚

å°‘ã—ã‚ã‹ã‚Šã«ãã„ã§ã™ãŒã€`fill-extrusion-base`ãŒ`20`ã€`fill-extrusion-height`ãŒ`50`ã®å ´åˆã€ã€Œåœ°ä¸Šã‹ã‚‰20mã‹ã‚‰50mã®éƒ¨åˆ†ã‚’å»ºç‰©ã¨ã—ã¦æç”»ã™ã‚‹ã€ã¨ã„ã†æŒ‡ç¤ºã«ãªã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€é«˜ã•30mã®å»ºç‰©ãŒ20mç©ºä¸­ã«æµ®ã„ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚

ã¾ãŸã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯`fill-extrusion-base`ã¨`fill-extrusion-height`ã«å°‘ã—è¤‡é›‘ãª[Expressions](https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/)ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚[`interpolate`](https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/#interpolate)ã¯è£œå®Œå‘½ä»¤ã§ã€ã“ã“ã§ã¯`zoom`ã«å¿œã˜ã¦`linear`ï¼ˆç·šå½¢ï¼‰ã«è£œå®Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã‚ºãƒ¼ãƒ `15`ã®ã¨ã`0`ã€ã‚ºãƒ¼ãƒ `15.05`ã®ã¨ãã«`height`ã¾ãŸã¯`min_height`ã®å€¤ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚ç·šå½¢è£œé–“ã•ã‚Œã‚‹ã®ã§ã‚ºãƒ¼ãƒ ãŒ[15,15.05]ã®åŒºé–“ã§ã¯[0,`height`]ã¾ãŸã¯[0,`min_height`]ã®å€¤ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚è‹±èªã®ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚‚ã‚ã‚Šã¾ã™ãŒã€ç·šå½¢è£œé–“ã™ã‚‹ã“ã¨ã§ã‚ºãƒ¼ãƒ ã«å¿œã˜ã¦å»ºç‰©ãŒã„ã„æ„Ÿã˜ã«åœ°é¢ã‹ã‚‰ç«‹ã¡ä¸ŠãŒã£ã¦ãã‚‹ã‚ˆã†ãªè¦–è¦šåŠ¹æœãŒã‚ã‚Šã¾ã™ã€‚

```JavaScript
    'paint': {
      'fill-extrusion-color': '#aaa',
  
      // Use an 'interpolate' expression to
      // add a smooth transition effect to
      // the buildings as the user zooms in.
      'fill-extrusion-height': [
        'interpolate',
        ['linear'],
        ['zoom'],
        15,
        0,
        15.05,
        ['get', 'height']
      ],
      'fill-extrusion-base': [
        'interpolate',
        ['linear'],
        ['zoom'],
        15,
        0,
        15.05,
        ['get', 'min_height']
      ],
      'fill-extrusion-opacity': 0.6
    }
  },
```

æœ€å¾Œã«`addLayer`ã®ç¬¬äºŒå¼•æ•°ã«å…ˆç¨‹æ¢ã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã®IDã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€`labelLayerId`ã®ä¸‹ã«`fill-extrusion`ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

```JavaScript
  labelLayerId
);
```

# ã¾ã¨ã‚

ã‚µãƒ³ãƒ—ãƒ«ã‚’é€šã˜ã¦`fill-extrusion`ã®ä½¿ã„æ–¹ãŒã”ç†è§£ã„ãŸã ã‘ãŸã‹ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€extrusionã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚‚åˆã‚ã›ã¦ã”å‚ç…§ãã ã•ã„ã€‚

@[card](https://zenn.dev/ottylab/articles/dae29a081139a0/)


# ãŠã¾ã‘

å…ˆæ—¥ã€[Mapbox Standard Styleã¨Mapbox GL JS v3.0.0-beta.1](https://www.mapbox.com/blog/standard-core-style)ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚[3D Tiles](https://cesium.com/why-cesium/3d-tiles/)ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«extrusionã§ã¯é›£ã—ã‹ã£ãŸæ±äº¬ã‚¿ãƒ¯ãƒ¼ã‚‚ãã‚Œã„ã«è¡¨ç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/OJrLxZE)

ã“ã‚Œä»¥å¤–ã«ã‚‚[GL JS v3ã§ã¯æ§˜ã€…ãªæ©Ÿèƒ½ãŒã‚µãƒãƒ¼ãƒˆ](https://github.com/mapbox/mapbox-gl-js/blob/main/MIGRATION_GUIDE_v3.md)ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãœã²ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚