---
title: "Mapbox Newsletter WEEKLY TIPSã®è§£èª¬ -ã€Œå ´æ‰€ã«ã‚†ã£ãã‚Šé£›ã¶ã€"
emoji: "ğŸ¦…"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "MapboxGLJS", "GIS", "JavaScript"]
published: false
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ã€å…ˆæ—¥é…ä¿¡ã•ã‚ŒãŸMapbox Newsletterã®WEEKLY TIPSã§ç´¹ä»‹ã•ã‚Œã¦ã„ãŸã€Œå ´æ‰€ã«ã‚†ã£ãã‚Šé£›ã¶ã€ã«ã¤ã„ã¦ã®è§£èª¬ã§ã™ã€‚ã“ã‚Œã¯[`Map#flyTo`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#flyto)ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä½¿ã„æ–¹ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã¾ãŸã€Newsletterã®è³¼èª­ã¯[ã“ã¡ã‚‰](https://www.mapbox.jp/blog?#:~:text=%E3%83%8B%E3%83%A5%E3%83%BC%E3%82%B9%E3%83%AC%E3%82%BF%E3%83%BC%E3%82%92%E8%B3%BC%E8%AA%AD)ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ã„ãŸã ã‘ã¾ã™ã€‚

ä»¥ä¸‹ãŒæœ¬ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¢ã§ã™ã€‚

@[codepen](https://codepen.io/OttyLab/pen/ExrLPmB)


# ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

ã¾ãšExamplesã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã«è¡Œãã¾ã—ã‚‡ã†ã€‚

æ—¥æœ¬èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/jp/mapbox-gl-js/example/flyto-options/)

è‹±èªã‚µã‚¤ãƒˆ
@[card](https://docs.mapbox.com/mapbox-gl-js/example/flyto-options/)

åŸºæœ¬çš„ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€è‹±èªç‰ˆã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒMapbox Streets v12ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã“ã¡ã‚‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Mapbox Streets v11ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãŒWebãƒ¡ãƒ«ã‚«ãƒˆãƒ«ã§ã‚ã‚‹ã®ã«å¯¾ã—ã€Mapbox Streets v12ã§ã¯Globeï¼ˆ3Dè¡¨ç¤ºã•ã‚ŒãŸåœ°çƒï¼‰ãªã®ã§ã€å°è±¡ãŒã‹ãªã‚Šç•°ãªã‚Šã¾ã™ã€‚ã¾ãŸã€ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§3Dåœ°å½¢ã‚„æ·±ã„ãƒ”ãƒƒãƒè§’ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå°è±¡çš„ãªé›°å›²æ°—ã«ä»•ä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚

## HTML/CSS

ã¾ãšCSSã§ã™ã€‚ä»¥ä¸‹ã¯ä¸Šéƒ¨ä¸­å¤®ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹Flyãƒœã‚¿ãƒ³ã®ãŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚

```css
#fly {
  display: block;
  position: relative;
  margin: 0px auto;
  width: 50%;
  height: 40px;
  padding: 10px;
  border: none;
  border-radius: 3px;
  font-size: 12px;
  text-align: center;
  color: #fff;
  background: #ee8a65;
}
```

æ¬¡ã«HTMLã§ã™ã€‚ä»¥ä¸‹ã¯åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

```HTML
<div id="map"></div>
```

ä»¥ä¸‹ã¯Flyãƒœã‚¿ãƒ³ã§ã™ã€‚
```HTML
<button id="fly">Fly</button>
```

## Mapã®ä½œæˆ

æ¬¡ã«JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ä»¥ä¸‹ã¯`flyTo`ã®å§‹ç‚¹ãƒ»çµ‚ç‚¹ã«ãŠã‘ã‚‹ã‚«ãƒ¡ãƒ©ã®è¨­å®šå€¤ã§ã™ã€‚ç‰¹ç­†ã™ã¹ãã¯`end.pitch`ãŒ`75`ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚Mapbox GL JS v2ã‹ã‚‰ã¯ãƒ”ãƒƒãƒãŒ80åº¦ã¾ã§è¨­å®šå¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼ˆv1ã¯60åº¦ï¼‰ãŒã€ãƒ”ãƒƒãƒã‚’å¤§ããè¨­å®šã™ã‚‹ã¨æ°´å¹³ç·šã¨ç©ºãŒã‚«ãƒ¡ãƒ©ã«åã¾ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```JavaScript
const start = {
  center: [80, 36],
  zoom: 1,
  pitch: 0,
  bearing: 0
};
const end = {
  center: [8.11862, 46.58842],
  zoom: 12.5,
  bearing: 130,
  pitch: 75
};
```

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã„ã¤ã‚‚é€šã‚Šã€Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚`container`ã§åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®idã‚’æŒ‡å®šã—ã¾ã™ã€‚
```JavaScript
const map = new mapboxgl.Map({
  container: 'map',
  // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
  style: 'mapbox://styles/mapbox/satellite-streets-v12',
  ...start
});
```
`...start`ã¯[ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ†ãƒ©ãƒ«ã§ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡ã§ã™](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Spread_syntax)ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ãŸã®ã¨åŒã˜åŠ¹æœãŒã‚ã‚Šã¾ã™ã€‚

```JavaScript
const map = new mapboxgl.Map({
  container: 'map',
  // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
  style: 'mapbox://styles/mapbox/satellite-streets-v12',
  center: [80, 36],
  zoom: 1,
  pitch: 0,
  bearing: 0
});
```

## ã‚¹ã‚¿ã‚¤ãƒ«ã®è¨­å®š
`map.on('style.load', () => {/* ã“ã“ */});`ã§ã¯ã‚¹ã‚¿ã‚¤ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã†è¨­å®šã‚’`/* ã“ã“ */`ã®éƒ¨åˆ†ã«è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦`style.load`ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ­ãƒ¼ãƒ‰ç›´å¾Œã€æç”»ã®ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®ã«ã¯æœ€åˆã‹ã‚‰è¨­å®šãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚

[`Map#setFog`](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#setfog)ã¯[`Fog`](https://docs.mapbox.com/style-spec/reference/fog/)ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚Fogã¨ã¯ç©ºã‚„å®‡å®™ã®è‰²ã‚„ã€éœ§ã£ã½ã•ã®æ¼”å‡ºã‚’è¡¨ç¾ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚`color`ã§æ°´å¹³ç·šã‚ˆã‚Šä¸‹ï¼ˆã¤ã¾ã‚Šéœ§ï¼‰ã®è‰²ã€`hight-color`ã§æ°´å¹³ç·šã‚ˆã‚Šä¸Šï¼ˆã¤ã¾ã‚Šç©ºï¼‰ã®è‰²ã‚’æŒ‡å®šã—ã¾ã™ã€‚`horizon-blend`ã¯ã“ã®äºŒè‰²ã®å¢ƒç•Œã‚’ã©ã‚Œã ã‘ã¼ã‹ã™ã‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
map.setFog({
  'color': 'rgb(220, 159, 159)', // Pink fog / lower atmosphere
  'high-color': 'rgb(36, 92, 223)', // Blue sky / upper atmosphere
  'horizon-blend': 0.4 // Exaggerate atmosphere (default is .1)
});
```
è©¦ã—ã«`'horizon-blend': 0`ã¨ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«äºŒè‰²ãŒãã£ãã‚Šã¨åˆ¥ã‚Œã¦ã“ã‚Œã‚‰ã®è¨­å®šå€¤ã®æŒ™å‹•ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚

![fog](/images/articles/bb5044866a1ad6/fog.png)

ç¶šã„ã¦3Dåœ°å½¢ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚ è¨­å®šæ–¹æ³•ã¯ã“ã‚Œä»¥å¤–ãªã„ã®ã§ã‚¤ãƒ‡ã‚£ã‚ªãƒ ã¨ã—ã¦è¦šãˆã¦ã—ã¾ã†ã®ãŒè‰¯ã„ã‹ã¨æ€ã„ã¾ã™ã€‚ã‚½ãƒ¼ã‚¹ã§èª­ã¿è¾¼ã‚“ã¦ã„ã‚‹[`mapbox.terrain-rgb`](https://docs.mapbox.com/data/tilesets/reference/mapbox-terrain-rgb-v1/)ã¯æ¨™é«˜æƒ…å ±ã‚’è‰²æƒ…å ±ã¨ã—ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ©ã‚¹ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ«ã‚»ãƒƒãƒˆã§ã™ã€‚`setTerrain`ã§ã“ã®ã‚½ãƒ¼ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€å†…éƒ¨çš„ã«ã¯`height = -10000 + ((R * 256 * 256 + G * 256 + B) * 0.1)`ã¨ã„ã†è¨ˆç®—ã§é«˜ã•ã‚’ç®—å‡ºã—ã€3Dåœ°å½¢ã‚’è¡¨ç¾ã—ã¾ã™ã€‚ã¡ãªã¿ã«ã€ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ã¯[`mapbox.mapbox-terrain-dem-v1`](https://docs.mapbox.com/data/tilesets/reference/mapbox-terrain-dem-v1/)ã‚’ç”¨ã„ã‚‹ã»ã†ãŒå¥½ã¾ã—ã„ã§ã™ã€‚

```JavaScript
map.addSource('mapbox-dem', {
  'type': 'raster-dem',
  'url': 'mapbox://mapbox.terrain-rgb'
});
 
map.setTerrain({
  'source': 'mapbox-dem',
  'exaggeration': 1.5
});
```

## Flyãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®æŒ™å‹•

ã„ã‚ˆã„ã‚ˆæœ¬é¡Œã§ã™ã€‚`isAtStart`ã¯"start -> end"æ–¹å‘ãªã®ã‹"end -> start"æ–¹å‘ãªã®ã‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ•ãƒ©ã‚°ã§ã™ã€‚
```JavaScript
let isAtStart = true;
```

Flyãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®æŒ™å‹•ã®å®šç¾©ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
```JavaScript
document.getElementById('fly').addEventListener('click', () => {
  //ã“ã“
});
```

å‘ãã«ã‚ˆã£ã¦start/endã©ã¡ã‚‰ãŒçµ‚ç‚¹ã«ãªã‚‹ã‹ã‚’æŒ‡å®šã—ã€æ¬¡å›ã®ãŸã‚ã«`isAtStart`ã‚’ãƒˆã‚°ãƒ«ã—ã¾ã™ã€‚
```JavaScript
  const target = isAtStart ? end : start;
  isAtStart = !isAtStart;
```

ã„ã‚ˆã„ã‚ˆ`flyTo`ã§ã™ã€‚[èª¬æ˜ã«ã‚‚ã‚ã‚‹é€šã‚Š](https://docs.mapbox.com/mapbox-gl-js/api/map/#map#flyto:~:text=Accepts%20CameraOptions%20%2C%20AnimationOptions)ã€`flyTo`ã¯[`CameraOptions`](https://docs.mapbox.com/mapbox-gl-js/api/properties/#cameraoptions)ã¨[`AnimationOptions`](https://docs.mapbox.com/mapbox-gl-js/api/properties/#animationoptions)ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æŒ‡å®šå¯èƒ½ã§ã™ã€‚`...target`ã¯`CameraOptions`ã«é–¢ã™ã‚‹è¨­å®šã€[`duration`](https://docs.mapbox.com/mapbox-gl-js/api/properties/#animationoptions:~:text=will%20be%20ignored.-,duration,-(number))ã¨[`essential`](https://docs.mapbox.com/mapbox-gl-js/api/properties/#animationoptions:~:text=the%20final%20state.-,essential,-(boolean))ã¯`AnimationOptions`ã«é–¢ã™ã‚‹è¨­å®šã§ã™ã€‚`duration`ã¯ä½•ç§’é–“ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹ã§ã™ã€‚`essential`ã‚’`true`ã«ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒOSã®è¨­å®šã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ‘åˆ¶ã™ã‚‹è¨­å®š(`prefers-reduced-motion`)ã«ã—ã¦ã„ã¦ã‚‚ç„¡è¦–ã—ã¾ã™ã€‚

```JavaScript
  map.flyTo({
    ...target, // Fly to the selected target
    duration: 12000, // Animate over 12 seconds
    essential: true // This animation is considered essential with
    //respect to prefers-reduced-motion
  });
```


# ã¾ã¨ã‚

ã„ã¡ã°ã‚“å¤§äº‹ãªã®ã¯`flyTo`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§`duration`ã‚’æŒ‡å®šã™ã‚‹éƒ¨åˆ†ã§ã—ãŸã€‚