---
title: "react-map-gl + Search JS (React)"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mapbox", "React", "GIS", "JavaScript"]
published: true
publication_name: "mapbox_japan"
---

# ã¯ã˜ã‚ã«

[å‰å›](https://zenn.dev/ottylab/articles/4e9e1fd64c4478)ã«ç¶šãã€react-map-glã‚’è©¦ã—ã¾ã™ã€‚ä»Šå›ã¯ä»¥ä¸‹ã®è¨˜äº‹ã§ã”ç´¹ä»‹ã—ãŸReactå®Ÿè£…ã®Search JSã‚’çµ„ã¿åˆã‚ã›ã¦ã¿ã¾ã™ã€‚

https://zenn.dev/ottylab/articles/ab629f6696e865

ä»¥ä¸‹ãŒãƒ‡ãƒ¢ã§ã™ã€‚[Safari](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚„[Firefox](https://developer.stackblitz.com/platform/webcontainers/browser-support#safari)ã‚’ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹æ–¹ã¯ãƒ‡ãƒ¢ãŒå®Ÿè¡Œã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚Chromeã§è¡¨ç¤ºã™ã‚‹ã‹ã€ https://stackblitz.com/edit/vitejs-vite-rf15vg ã‚’ç›´æ¥ã”å‚ç…§ãã ã•ã„ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-rf15vg?embed=1&view=preview)


# ãŠã•ã‚‰ã„
Search JSã®Reactå®Ÿè£…ã®ä½¿ã„æ–¹ã‚’ãŠã•ã‚‰ã„ã—ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«`props`ã‚’æŒ‡å®šã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚ç‰¹ã«ã“ã“ã§å¤§äº‹ãªã®ã¯`map`ã§ã™ã€‚ã“ã“ã«ã¯[Mapbox GLJSã®Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](https://docs.mapbox.com/mapbox-gl-js/api/map/)ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```JavaScript
<SearchBox
  accessToken={accessToken}
  map={mapInstanceRef.current}
  mapboxgl={mapboxgl}
  value={inputValue}
  options={{ country: 'jp', language: 'ja' }}
  onChange={(d) => {
    setInputValue(d);
  }}
  marker
/>
```

# Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å–å¾—æ–¹æ³•
react-map-glã§ã¯Mapbox GL JSã®Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯[Mapã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](https://visgl.github.io/react-map-gl/docs/api-reference/map)å†…éƒ¨ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€react-map-glã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµŒç”±ã§Mapã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚ã—ã‹ã—ã€å¤–éƒ¨ã«ã¯å…¬é–‹ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ãã“ã§ä»£ã‚ã‚Šã«[`useMap`](https://visgl.github.io/react-map-gl/docs/api-reference/use-map)ã¨ã„ã†ãƒ•ãƒƒã‚¯ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚React JSã¯react-map-glã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãªã„ã®ã§ã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¾ã™ã€‚


# å‹•ã‹ãªã„ã‚³ãƒ¼ãƒ‰

ã¨ã„ã†ã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Appã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­ã§`useMap`ã‚’ä½¿ç”¨ã—ã€SearchBoxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½¿ç”¨ã—ã¦ã¿ã¾ã—ãŸã€‚ãŒã€ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯SerchBoxæ¤œç´¢å¾Œã®ã‚«ãƒ¡ãƒ©ã®ç§»å‹•ã€ãƒ”ãƒ³ã®è¨­ç½®ç­‰ãŒå‹•ä½œã—ã¾ã›ã‚“ã€‚

```JavaScript
function App() {
  const {current: map} = useMap();
  const [inputValue, setInputValue] = useState('');
  return (
    <Map
      mapLib={import('mapbox-gl')}
      initialViewState={{
        longitude: 139.76711,
        latitude: 35.68074,
        zoom: 3 
      }}
      style={{position: "absolute", top: 0, bottom: 0, width: "100%"}}
      mapStyle="mapbox://styles/mapbox/streets-v12"
      mapboxAccessToken={accessToken}
    >
      <SearchBox
        accessToken={accessToken}
        map={map?.getMap()}
        mapboxgl={mapboxgl}
        value={inputValue}
        options={{ country: 'jp', language: 'ja' }}
        onChange={(d) => {
          setInputValue(d);
        }}
        marker
      />
    </Map>
  )
}
```

ã“ã‚Œã¯[useContext](https://react.dev/reference/react/useContext#caveats)ã®ä»¥ä¸‹ã®åˆ¶é™ã«ã‚ˆã‚‹ã‚‚ã®ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

> useContext() call in a component is not affected by providers returned from the same component. The corresponding <Context.Provider> needs to be above the component doing the useContext() call.


# ãƒ©ãƒƒãƒ—ã™ã‚‹

ã¨ã„ã†ã“ã¨ã§ã€SearchBoxã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```JavaScript:SearchBoxWrapper.jsx
import { useState } from 'react';
import { useMap }  from 'react-map-gl';
import { SearchBox } from '@mapbox/search-js-react';
import mapboxgl from 'mapbox-gl';

export default function SearchBoxWrapper(props) {
  const {current: map} = useMap();
  const [inputValue, setInputValue] = useState('');

  return (
      <SearchBox
        accessToken={props.accessToken}
        map={map.getMap()}
        mapboxgl={mapboxgl}
        value={inputValue}
        options={{ country: 'jp', language: 'ja' }}
        onChange={(d) => {
          setInputValue(d);
        }}
        marker
      />
  )
}
```

ãã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```JavaScript:App.jsx
<Map
  mapLib={import('mapbox-gl')}
  initialViewState={{
    longitude: 139.76711,
    latitude: 35.68074,
    zoom: 3 
  }}
  style={{position: "absolute", top: 0, bottom: 0, width: "100%"}}
  mapStyle="mapbox://styles/mapbox/streets-v12"
  mapboxAccessToken={accessToken}
>
  <SearchBoxWrapper accessToken={accessToken} />
/Map>
```


# ã¾ã¨ã‚
Search JSã¯react-map-glã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãªã„ã®ã§ä¸€å·¥å¤«å¿…è¦ã§ã—ãŸã€‚
